<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>OSINT Report for {{ sh_domain }}</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono&family=IBM+Plex+Sans:wght@400;600&family=IBM+Plex+Mono&family=Fira+Sans:wght@400;600&family=Fira+Code&family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style media="print">
    @page { size: A4; margin: 20mm; }
    body { padding:0!important; background:#fff!important; color:#000!important; }
    .control-panel, .toc-container, .back-to-top { display:none!important; }
    h1,h2,h3 { page-break-after:avoid; }
    section { page-break-inside:avoid; }
  </style>
  <style>
    :root{
      --bg-color:#fff;--text-color:#333;--link-color:#007bff;
      --accent-color:#333399;--hr-color:#ccc;
      --font-main:'Inter',sans-serif;--font-code:'Roboto Mono',monospace;
    }
    body.dark{
      --bg-color:#1e1e1e;--text-color:#ccc;--link-color:#7ca9ff;
      --accent-color:#9db2ff;--hr-color:#444;
    }
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
    html{scroll-behavior:smooth;}
    body{
      font:15px/1.6 var(--font-main);
      background:var(--bg-color);color:var(--text-color);
      padding:24px 24px 24px 260px;
      transition:background .3s,color .3s;
    }
    h1,h2,h3{text-align:center;font-weight:700;font-family:var(--font-main);margin:24px 0 12px;}
    h1{font-size:28px;text-decoration:underline;}
    h2{font-size:22px;}
    h3{font-size:18px;text-decoration:underline;margin-top:36px;}
    p{margin:6px 0 12px;}
    ul{margin:6px 0 12px 24px;}
    li{margin:4px 0;}
    hr{margin:24px 0;border:none;border-top:1px solid var(--hr-color);}
    pre,code{font-family:var(--font-code);color:var(--accent-color);white-space:pre-wrap;margin:12px 0;}
    .blue{color:var(--accent-color);}
    .red{color:#f00;}
    .maroon{color:#800000;}
    .underline{text-decoration:underline;}
    .progress-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 0;
      height: 4px;
      background: var(--accent-color);
      z-index: 1001;
      transition: width 0.2s;
    }
    section { transition: transform 0.3s, opacity 0.3s; }
    section.active { transform: translateX(10px); border-left: 3px solid var(--accent-color); padding-left: 10px; }
    details { margin: 10px 0; padding: 10px; border-radius: 4px; border: 1px solid var(--hr-color); transition: all 0.3s ease; }
    details:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    details[open] { background: var(--bg-color); border-color: var(--accent-color); }
    details > summary { padding: 8px; cursor: pointer; user-select: none; }
    details > pre { margin-top: 10px; padding: 15px; border-radius: 4px; background: rgba(0,0,0,0.03); }
    .toc-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--bg-color);
      border: 1px solid var(--hr-color);
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      color: var(--text-color);
      font-family: var(--font-main);
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .toc-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 240px;
      height: 100vh;
      overflow-y: auto;
      background: var(--bg-color);
      border-right: 1px solid var(--hr-color);
      padding: 20px 10px;
      font-family: var(--font-main);
      transition: width 0.3s ease;
    }
    .toc-container.collapsed { width: 50px; overflow: visible; }
    .toc-container.collapsed .toc-section-title,
    .toc-container.collapsed .toc-link,
    .toc-container.collapsed h2 { opacity: 0; visibility: hidden; position: absolute; pointer-events: none; }
    .toc-container.collapsed .toc-toggle { right: -30px; position: absolute; top: 10px; }
    .toc-section-title{text-align:center;margin:10px 0 8px;font-weight:bold;}
    .toc-link{display:block;text-align:center;margin-bottom:6px;
      color:var(--link-color);text-decoration:none;}
    .toc-link:hover{text-decoration:underline;}
    .toc-link.active{font-weight:700;background:var(--accent-color);color:#fff;border-radius:4px;}
    .control-panel{
      position:fixed;top:10px;right:20px;z-index:1000;
      display:flex;flex-direction:column;align-items:center;gap:8px;
      background:var(--bg-color);padding:10px 14px;
      border:1px solid var(--hr-color);border-radius:6px;
      box-shadow:0 2px 6px rgba(0,0,0,.08);
    }
    .theme-toggle,.font-select{
      background:var(--bg-color);color:var(--text-color);
      border:1px solid var(--hr-color);border-radius:4px;
      font-family:var(--font-main);transition:background .3s,color .3s;
    }
    .theme-toggle{padding:6px 12px;cursor:pointer;}
    .font-select{padding:6px 8px;}
    .back-to-top{text-align:right;margin-top:16px;}
    details summary{cursor:pointer;font-weight:bold;margin-bottom:6px;}
    details[open]>summary::after{content:" ‚ñ≤";float:right;}
    details>summary::after{content:" ‚ñº";float:right;}
    .technical-term { text-decoration: underline dotted; cursor: help; position: relative; }
    .term-tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--accent-color);
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 14px;
      white-space: nowrap;
      z-index: 1000;
      animation: fadeIn 0.3s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(-50%) translateY(10px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
    #graph-legend { margin: 0 auto 16px; max-width: 900px; display: flex; flex-wrap: wrap; gap: 16px; justify-content: center; }
    .legend-item { display: flex; align-items: center; gap: 6px; font-size: 14px; }
    .legend-dot { width: 18px; height: 18px; border-radius: 50%; display: inline-block; border: 2px solid #333; }
    #graph-search { margin: 0 auto 12px; display: flex; justify-content: center; gap: 8px; }
    #graph-search input { font-size: 15px; padding: 4px 8px; border-radius: 4px; border: 1px solid #ccc; }
    #graph-search button { font-size: 15px; padding: 4px 10px; border-radius: 4px; border: 1px solid #ccc; background: #f5f5f5; cursor: pointer; }
    #graph-export { margin: 0 auto 12px; display: flex; justify-content: center; gap: 8px; }
    #graph-export button { font-size: 15px; padding: 4px 10px; border-radius: 4px; border: 1px solid #ccc; background: #f5f5f5; cursor: pointer; }
    .vis-tooltip { font-size: 15px !important; }
    #osintNetwork { width:100%;max-width:1400px;height:700px;border:1px solid #ccc;margin:0 auto 24px; background: #fafaff; }
    #osintNetwork.fullscreen {
      position: fixed !important;
      top: 0; left: 0; right: 0; bottom: 0;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 2000;
      background: #fafaff;
      border: none;
      margin: 0 !important;
      box-shadow: none;
    }
    body.fullscreen-graph {
      overflow: hidden;
    }
    #exitFullscreenBtn {
      position: fixed;
      top: 120px;
      right: 32px;
      z-index: 2100;
      font-size: 20px;
      background: #fff;
      color: #333;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 6px 16px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      display: none;
    }
    #osintNetwork.fullscreen + #exitFullscreenBtn {
      display: block;
    }
  </style>
</head>
<body id="top">
<div class="control-panel">
  <div style="display:flex;gap:8px;">
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">üåì Theme</button>
    <button id="printBtn" class="theme-toggle" aria-label="Print report">üñ®Ô∏è Print</button>
  </div>
  <select id="fontSelect" onchange="changeFont(this.value)" class="font-select" aria-label="Font select">
    <option value="inter">Inter + Roboto Mono</option>
    <option value="plex">IBM Plex Sans + Mono</option>
    <option value="fira">Fira Sans + Fira Code</option>
    <option value="grotesk">Space Grotesk + Roboto Mono</option>
  </select>
</div>
<div class="progress-bar"></div>
<div class="toc-container">
  <button class="toc-toggle" onclick="toggleToc()">‚â°</button>
  <h2 class="underline"><i><style="color:#3F51B5;"></i> Table of contents</h2>
  <a href="#general-scan-info" class="toc-link">
    <i class="fas fa-info-circle" style="color:#2196F3;"></i> 1. General scan information
  </a>
  <a href="#general-scan-statistics" class="toc-link">
    <i class="fas fa-chart-bar" style="color:#4CAF50;"></i> 2. General scan statistics
  </a>
  <a href="#domain-infrastructure-visualisation" class="toc-link">
    <i class="fas fa-network-wired" style="color:#FF9800;"></i> 3. Domain infrastructure visualisation
  </a>
  <p class="toc-section-title maroon underline">[BASIC SCAN INFO]</p>
  <a href="#whois-info" class="toc-link">
    <i class="fas fa-id-badge" style="color:#3F51B5;"></i> 4. WHOIS information
  </a>
  <a href="#social-media-links" class="toc-link">
    <i class="fas fa-hashtag" style="color:#E91E63;"></i> 5. Social media links
  </a>
  <a href="#subdomains-info" class="toc-link">
    <i class="fas fa-network-wired" style="color:#9C27B0;"></i> 6. Subdomains
  </a>
  <a href="#dns-ssl-info" class="toc-link">
    <i class="fas fa-shield-alt" style="color:#607D8B;"></i> 7. DNS & SSL
  </a>
  <a href="#services-frameworks-info" class="toc-link">
    <i class="fas fa-cogs" style="color:#F57C00;"></i> 8. Services & Frameworks
  </a>
  <a href="#pre-pentest-info" class="toc-link">
    <i class="fas fa-bug" style="color:#F44336;"></i> 9. Pre-Pentest Info
  </a>
  <a href="#pre-pentest-info" class="toc-link">
    <i class="fas fa-code" style="color:#795548;"></i> 10. Website configuration files
  </a>
  <p class="toc-section-title maroon underline">[DORKING SCAN INFO]</p>
  <a href="#dorking-info" class="toc-link">
    <i class="fas fa-search" style="color:#009688;"></i> 11. Dorking Results
  </a>
  <p class="toc-section-title maroon underline">[PAGESEARCH SCAN INFO]</p>
  <a href="#pagesearch-results" class="toc-link">
    <i class="fas fa-file-alt" style="color:#3F51B5;"></i> 12. PageSearch Results
  </a>
  <p class="toc-section-title maroon underline">[API SCAN INFO]</p>
  <a href="#virustotal-results" class="toc-link">
    <i class="fas fa-viruses" style="color:#D32F2F;"></i> 13. VirusTotal
  </a>
  <a href="#securitytrails-results" class="toc-link">
    <i class="fas fa-map-marked-alt" style="color:#0097A7;"></i> 14. SecurityTrails
  </a>
  <a href="#hudsonrock-results" class="toc-link">
    <i class="fas fa-user-secret" style="color:#7B1FA2;"></i> 15. HudsonRock
  </a>
</div>
<h1>Open Source Information Research Report</h1>
<h2>{{ org }}</h2>
<hr>
<h3 id="general-scan-info">GENERAL SCAN INFORMATION</h3>
<p>
  <strong>
    <i class="fas fa-robot" style="color:#9C27B0;"></i> Status of robots.txt extraction:
  </strong>
  <span class="blue">{{ robots_txt_result }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-sitemap" style="color:#4CAF50;"></i> Status of sitemap.xml extraction:
  </strong>
  <span class="blue">{{ sitemap_xml_result }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-link" style="color:#2196F3;"></i> Status of sitemap.xml links extraction:
  </strong>
  <span class="blue">{{ sitemap_links }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-search" style="color:#F57C00;"></i> Google Dorking status:
  </strong>
  <span class="blue">{{ dorking_status }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-microscope" style="color:#E91E63;"></i> PageSearch conduction:
  </strong>
  <span class="blue">{{ pagesearch_ui_mark }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-camera" style="color:#009688;"></i> Snapshotting conduction:
  </strong>
  <span class="blue">{{ snapshotting_ui_mark }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-clock" style="color:#607D8B;"></i> Report creation time:
  </strong>
  <span class="blue">{{ ctime }}</span>
</p>
<div class="back-to-top"><a href="#top" class="toc-link">‚Üë Back to top</a></div>
<hr>
<h3 id="general-scan-statistics">GENERAL SCAN STATISTICS</h3>
<div>
  <p>
    <strong><i class="fas fa-network-wired" style="color:#3F51B5;"></i> Total subdomains found:</strong>
    <span class="blue" id="a_tsf">{{ a_tsf }}</span>
  </p>
  <p>
    <strong><i class="fas fa-hashtag" style="color:#E91E63;"></i> Total social media links found:</strong>
    <span class="blue" id="a_tsm">{{ a_tsm }}</span>
  </p>
  <p>
    <strong><i class="fas fa-envelope" style="color:#009688;"></i> Total emails found:</strong>
    <span class="blue" id="a_temails">{{ a_temails }}</span>
  </p>
  <p>
    <strong><i class="fas fa-globe" style="color:#2196F3;"></i> Total associated IP addresses found:</strong>
    <span class="blue" id="a_tips">{{ a_tips }}</span>
  </p>
  <p>
    <strong><i class="fas fa-door-open" style="color:#FB8C00;"></i> Total open ports found:</strong>
    <span class="blue" id="a_tops">{{ a_tops }}</span>
  </p>
  <p>
    <strong><i class="fas fa-bug" style="color:#F44336;"></i> Total potential vulnerabilities found:</strong>
    <span class="blue" id="a_tpv">{{ a_tpv }}</span>
  </p>
  <p>
    <strong><i class="fas fa-network-wired" style="color:#3F51B5;"></i> Accessible subdomains (PageSearch):</strong>
    <span class="blue" id="ps_s">{{ ps_s }}</span>
  </p>
  <p>
    <strong><i class="fas fa-envelope-open-text" style="color:#009688;"></i> Email addresses (PageSearch):</strong>
    <span class="blue" id="ps_e">{{ ps_e }}</span>
  </p>
  <p>
    <strong><i class="fas fa-file-alt" style="color:#607D8B;"></i> Found documents (PageSearch):</strong>
    <span class="blue" id="ps_f">{{ ps_f }}</span>
  </p>
  <p>
    <strong><i class="fas fa-cookie-bite" style="color:#6D4C41;"></i> Found cookies (PageSearch):</strong>
    <span class="blue" id="ps_c">{{ ps_c }}</span>
  </p>
  <p>
    <strong><i class="fas fa-key" style="color:#5E35B1;"></i> Found API keys (PageSearch):</strong>
    <span class="blue" id="ps_a">{{ ps_a }}</span>
  </p>
  <p>
    <strong><i class="fas fa-cube" style="color:#00ACC1;"></i> Found WEB elements (PageSearch):</strong>
    <span class="blue" id="ps_w">{{ ps_w }}</span>
  </p>
  <p>
    <strong><i class="fas fa-unlock-alt" style="color:#D32F2F;"></i> Exposed passwords (PageSearch):</strong>
    <span class="blue" id="ps_p">{{ ps_p }}</span>
  </p>
</div>
<div style="display: flex; align-items: flex-start; gap: 40px; margin-top: 40px; justify-content: flex-start;">
  <div style="flex:1; max-width:500px; min-width:350px;">
    <canvas id="statsChart" width="500" height="400"></canvas>
  </div>
  <div style="flex:1; max-width:400px; min-width:300px;">
    <canvas id="socialPie" width="400" height="400"></canvas>
    <div id="socialCounts"
         data-fb="{{ fb_links|length }}"
         data-tw="{{ (tw_links|length) + (xcom_links|length) }}"
         data-inst="{{ inst_links|length }}"
         data-tg="{{ tg_links|length }}"
         data-tt="{{ tt_links|length }}"
         data-li="{{ li_links|length }}"
         data-vk="{{ vk_links|length }}"
         data-yt="{{ yt_links|length }}"
         data-ok="{{ ok_links|length }}"
         data-wc="{{ wc_links|length }}"
         style="display:none;">
    </div>
  </div>
</div>
<hr>
<h3 id="domain-infrastructure-visualisation">DOMAIN INFRASTRUCTURE VISUALISATION</h3>
<div id="graph-legend" aria-label="Graph legend">
  <span class="legend-item"><span class="legend-dot" style="background:#3F51B5"></span>Domain</span>
  <span class="legend-item"><span class="legend-dot" style="background:#607D8B"></span>Services</span>
  <span class="legend-item"><span class="legend-dot" style="background:#2196F3"></span>Subdomains</span>
  <span class="legend-item"><span class="legend-dot" style="background:#E91E63"></span>Socials</span>
  <span class="legend-item"><span class="legend-dot" style="background:#009688"></span>IPs</span>
  <span class="legend-item"><span class="legend-dot" style="background:#FB8C00"></span>Ports</span>
  <span class="legend-item"><span class="legend-dot" style="background:#F44336"></span>Vulnerabilities</span>
</div>
<div id="graph-search">
  <input type="text" id="graphSearchInput" placeholder="Search node..." aria-label="Search node">
  <button id="graphSearchBtn" aria-label="Search">üîç</button>
  <button id="graphClearBtn" aria-label="Clear search">‚úñ</button>
</div>
<div id="graph-export">
  <button id="exportPngBtn" aria-label="Export PNG">Export PNG</button>
  <button id="fullscreenGraphBtn" aria-label="Enter full screen mode">Expanded mode</button>
</div>
<div style="text-align:left;max-width:1400px;margin:0 auto 8px;">
  <button id="resetGraphBtn">Reset graph</button>
  <button id="expandAllBtn">Expand all nodes</button>
  <button id="collapseBtn" disabled>Collapse selected node</button>
  <button id="clusterBtn">Cluster subdomains</button>
  <button id="unclusterBtn">Uncluster all</button>
</div>
<div id="osintNetwork" tabindex="0" aria-label="Domain infrastructure graph"></div>
<button id="exitFullscreenBtn" style="display:none;">Exit graph expanded mode</button>
<div class="back-to-top"><a href="#top" class="toc-link">‚Üë Back to top</a></div>
<hr>

<h3 id="whois-info">WHOIS INFORMATION</h3>
<p>
  <strong><i class="fas fa-globe" style="color:#1E88E5;"></i> Domain:</strong>
  <span class="blue">{{ sh_domain }}</span>
</p>
<p>
  <strong><i class="fas fa-link" style="color:#43A047;"></i> Full URL:</strong>
  <a href="{{ full_url }}" target="_blank" class="blue">{{ full_url }}</a>
</p>
<p>
  <strong><i class="fas fa-network-wired" style="color:#E53935;"></i> IP address:</strong>
  <span class="blue">{{ ip_address }}</span>
</p>
<p>
  <strong><i class="fas fa-building" style="color:#6D4C41;"></i> Registrar:</strong>
  <span class="blue">{{ registrar }}</span>
</p>
<p>
  <strong><i class="fas fa-calendar-plus" style="color:#FB8C00;"></i> Creation date:</strong>
  <span class="blue">{{ creation_date }}</span>
</p>
<p>
  <strong><i class="fas fa-calendar-times" style="color:#D81B60;"></i> Expiration date:</strong>
  <span class="blue">{{ expiration_date }}</span>
</p>
<p>
  <strong><i class="fas fa-briefcase" style="color:#5E35B1;"></i> Organization name:</strong>
  <span class="blue">{{ org }}</span>
</p>
<p>
  <strong><i class="fas fa-envelope" style="color:#00897B;"></i> Contact e-mails:</strong>
  <span class="blue">{{ mails }}</span>
</p>
<div class="back-to-top"><a href="#top" class="toc-link">‚Üë Back to top</a></div>
<hr>

<h3 id="social-media-links">SOCIAL MEDIA LINKS</h3>
<p><strong><i class="fab fa-facebook-square" style="color:#1877f2;"></i> FACEBOOK:</strong></p>
<ul>
  {% for link in fb_links %}
  <li>‚áí <a href="{{ link }}" target="_blank" class="blue">{{ link }}</a></li>
  {% endfor %}
</ul>
<p><strong><i class="fab fa-twitter" style="color:#1da1f2;"></i> TWITTER (+ X.com):</strong></p>
<ul>
  {% for link in tw_links %}
  <li>‚áí <a href="{{ link }}" target="_blank" class="blue">{{ link }}</a></li>
  {% endfor %}
  {% for link in xcom_links %}
  <li>‚áí <a href="{{ link }}" target="_blank" class="blue">{{ link }}</a></li>
  {% endfor %}
</ul>
<p><strong><i class="fab fa-instagram" style="color:#e1306c;"></i> INSTAGRAM:</strong></p>
<ul>
  {% for link in inst_links %}
  <li>‚áí <a href="{{ link }}" target="_blank" class="blue">{{ link }}</a></li>
  {% endfor %}
</ul>
<p><strong><i class="fab fa-telegram" style="color:#0088cc;"></i> TELEGRAM:</strong></p>
<ul>
  {% for link in tg_links %}
  <li>‚áí <a href="{{ link }}" target="_blank" class="blue">{{ link }}</a></li>
  {% endfor %}
</ul>
<p><strong><i class="fab fa-tiktok" style="color:#111;"></i> TIKTOK:</strong></p>
<ul>
  {% for link in tt_links %}
  <li>‚áí <a href="{{ link }}" target="_blank" class="blue">{{ link }}</a></li>
  {% endfor %}
</ul>
<p><strong><i class="fab fa-linkedin" style="color:#0077b5;"></i> LINKEDIN:</strong></p>
<ul>
  {% for link in li_links %}
  <li>‚áí <a href="{{ link }}" target="_blank" class="blue">{{ link }}</a></li>
  {% endfor %}
</ul>
<p><strong><i class="fab fa-vk" style="color:#4a76a8;"></i> VKONTAKTE:</strong></p>
<ul>
  {% for link in vk_links %}
  <li>‚áí <a href="{{ link }}" target="_blank" class="blue">{{ link }}</a></li>
  {% endfor %}
</ul>
<p><strong><i class="fab fa-youtube" style="color:#ff0000;"></i> YOUTUBE:</strong></p>
<ul>
  {% for link in yt_links %}
  <li>‚áí <a href="{{ link }}" target="_blank" class="blue">{{ link }}</a></li>
  {% endfor %}
</ul>
<p><strong><i class="fab fa-odnoklassniki" style="color:#ff8000;"></i> ODNOKLASSNIKI:</strong></p>
<ul>
  {% for link in ok_links %}
  <li>‚áí <a href="{{ link }}" target="_blank" class="blue">{{ link }}</a></li>
  {% endfor %}
</ul>
<p><strong><i class="fab fa-weixin" style="color:#7bb32e;"></i> WECHAT:</strong></p>
<ul>
  {% for link in wc_links %}
  <li>‚áí <a href="{{ link }}" target="_blank" class="blue">{{ link }}</a></li>
  {% endfor %}
</ul>
<div class="back-to-top"><a href="#top" class="toc-link">‚Üë Back to top</a></div>
<hr>

<h3 id="dns-ssl-info">DNS & SSL INFORMATION</h3>
<p>
  <strong>
    <i class="fas fa-server" style="color:#2196F3;"></i> (DNS) Name servers:
  </strong>
  <span class="blue">{{ name_servers }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-envelope-open-text" style="color:#FF9800;"></i> (DNS) MX addresses:
  </strong>
  <span class="blue">{{ mx_records }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-user-check" style="color:#5C6BC0;"></i> (SSL) Issuer:
  </strong>
  <span class="blue">{{ issuer }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-user-lock" style="color:#9C27B0;"></i> (SSL) Subject:
  </strong>
  <span class="blue">{{ subject }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-calendar-plus" style="color:#43A047;"></i> (SSL) Not before:
  </strong>
  <span class="blue">{{ notBefore }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-calendar-times" style="color:#E53935;"></i> (SSL) Not after:
  </strong>
  <span class="blue">{{ notAfter }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-certificate" style="color:#00ACC1;"></i> (SSL) Certificate name:
  </strong>
  <span class="blue">{{ commonName }}</span>
</p>
<p>
  <strong>
    <i class="fas fa-fingerprint" style="color:#FF5722;"></i> (SSL) Certificate serial number:
  </strong>
  <span class="blue">{{ serialNumber }}</span>
</p>
<div class="back-to-top">
  <a href="#top" class="toc-link">‚Üë Back to top</a>
</div>
<hr>

<h3 id="services-frameworks-info">SERVICES & FRAMEWORKS INFORMATION</h3>
<p>
  <strong><i class="fas fa-server" style="color:#1976D2;"></i> Web servers:</strong>
</p>
<ul>
  {% for ws in web_servers %}
  <li class="blue">‚áí {{ ws }}</li>
  {% endfor %}
</ul>
<p>
  <strong><i class="fas fa-tools" style="color:#F57C00;"></i> CMS:</strong>
</p>
<ul>
  {% for cm in cms %}
  <li class="blue">‚áí {{ cm }}</li>
  {% endfor %}
</ul>
<p>
  <strong><i class="fas fa-code" style="color:#43A047;"></i> Used programming languages:</strong>
</p>
<ul>
  {% for pl in programming_languages %}
  <li class="blue">‚áí {{ pl }}</li>
  {% endfor %}
</ul>
<p>
  <strong><i class="fas fa-layer-group" style="color:#7E57C2;"></i> Used web frameworks:</strong>
</p>
<ul>
  {% for wf in web_frameworks %}
  <li class="blue">‚áí {{ wf }}</li>
  {% endfor %}
</ul>
<p>
  <strong><i class="fas fa-chart-line" style="color:#00ACC1;"></i> Analytics service:</strong>
</p>
<ul>
  {% for analytic in analytics %}
  <li class="blue">‚áí {{ analytic }}</li>
  {% endfor %}
</ul>
<p>
  <strong><i class="fab fa-js-square" style="color:#F7DF1E;"></i> Used JavaScript frameworks:</strong>
</p>
<ul>
  {% for jsf in javascript_frameworks %}
  <li class="blue">‚áí {{ jsf }}</li>
  {% endfor %}
</ul>
<p>
  <strong><i class="fas fa-tags" style="color:#9E9E9E;"></i> Tags:</strong>
</p>
<ul>
  {% for tag in tags %}
  <li class="blue">‚áí {{ tag }}</li>
  {% endfor %}
</ul>
<p>
  <strong><i class="fas fa-boxes" style="color:#607D8B;"></i> Common Platform Enumeration:</strong>
</p>
<ul>
  {% for cpe in cpes %}
  <li class="blue">‚áí {{ cpe }}</li>
  {% endfor %}
</ul>
<div class="back-to-top"><a href="#top" class="toc-link">‚Üë Back to top</a></div>
<hr>

<h3 id="pre-pentest-info">BASIC PRE-PENTEST INFORMATION</h3>
<p>
  <strong><i class="fas fa-door-open" style="color:#FB8C00;"></i> Open ports:</strong>
</p>
<ul>
  {% for op in ports %}
  <li class="blue">‚áí {{ op }}</li>
  {% endfor %}
</ul>
<p>
  <strong><i class="fas fa-globe" style="color:#1976D2;"></i> Hostnames:</strong>
</p>
<ul>
  {% for hn in hostnames %}
  <li class="blue">‚áí {{ hn }}</li>
  {% endfor %}
</ul>
<p>
  <strong><i class="fas fa-bug" style="color:#E53935;"></i> Potential vulnerabilities:</strong>
</p>
<ul>
  {% for vuln in vulns %}
  <li class="blue">‚áí {{ vuln }}</li>
  {% endfor %}
</ul>
<div class="back-to-top"><a href="#top" class="toc-link">‚Üë Back to top</a></div>
<hr>

<h3 id="technical-files">WEBSITE TECHNICAL FILES</h3>
<details>
  <summary>
    <i class="fas fa-robot" style="color:#9C27B0;"></i> robots.txt
  </summary>
  <pre>{{ robots_content | safe }}</pre>
</details>
<details>
  <summary>
    <i class="fas fa-sitemap" style="color:#4CAF50;"></i> sitemap.xml
  </summary>
  <pre>{{ sitemap_xml_content | safe }}</pre>
</details>
<details>
  <summary>
    <i class="fas fa-link" style="color:#2196F3;"></i> Sitemap links
  </summary>
  <pre>{{ sitemap_txt_content | safe }}</pre>
</details>
<div class="back-to-top"><a href="#top" class="toc-link">‚Üë Back to top</a></div>
<hr>

{% if add_dsi %}
<h3 id="dorking-info">DORKING SCAN INFO</h3>
<details>
  <summary>
    <i class="fas fa-search" style="color:#009688;"></i> Dorking Results
  </summary>
  <pre>{{ add_dsi | safe }}</pre>
</details>
<div class="back-to-top"><a href="#top" class="toc-link">‚Üë Back to top</a></div>
<hr>
{% endif %}

{% if ps_string %}
<h3 id="pagesearch-results">PAGESEARCH RESULTS</h3>
<details>
  <summary>
    <i class="fas fa-file-alt" style="color:#3F51B5;"></i> PageSearch Process Listing
  </summary>
  <pre>{{ ps_string }}</pre>
</details>
<div class="back-to-top"><a href="#top" class="toc-link">‚Üë Back to top</a></div>
<hr>
{% endif %}

{% if virustotal_output %}
<h3 id="virustotal-results">VIRUSTOTAL API SCAN RESULTS</h3>
<details>
  <summary title="Results from VirusTotal malware analysis">
    <i class="fas fa-viruses" style="color:#D32F2F;"></i> VirusTotal Output
  </summary>
  <pre>{{ virustotal_output | safe }}</pre>
</details>
<div class="back-to-top"><a href="#top" class="toc-link">‚Üë Back to top</a></div>
<hr>
{% endif %}

{% if securitytrails_output %}
<h3 id="securitytrails-results">SECURITYTRAILS API SCAN RESULTS</h3>
<details>
  <summary>
    <i class="fas fa-map-marked-alt" style="color:#0097A7;"></i> SecurityTrails Output
  </summary>
  <pre>{{ securitytrails_output | safe }}</pre>
</details>
<div class="back-to-top"><a href="#top" class="toc-link">‚Üë Back to top</a></div>
<hr>
{% endif %}

{% if hudsonrock_output %}
<h3 id="hudsonrock-results">HUDSONROCK API SCAN RESULTS</h3>
<details>
  <summary>
    <i class="fas fa-user-secret" style="color:#7B1FA2;"></i> HudsonRock Output
  </summary>
  <pre>{{ hudsonrock_output | safe }}</pre>
</details>
<div class="back-to-top"><a href="#top" class="toc-link">‚Üë Back to top</a></div>
<hr>
{% endif %}

<h3 style="text-align:center; padding-top: 10px;">Created using DPULSE software by OSINT-TECHNOLOGIES</h3>
<p style="text-align:center;">Visit our web-pages:</p>
<ul style="text-align:center; list-style: none; padding-left: 0;">
  <li><a href="https://github.com/OSINT-TECHNOLOGIES" target="_blank" class="blue">https://github.com/OSINT-TECHNOLOGIES</a></li>
  <li><a href="https://pypi.org/project/dpulse/" target="_blank" class="blue">https://pypi.org/project/dpulse/</a></li>
</ul>
<script>
  const fontMap = {
    inter: { main: "'Inter', sans-serif", code: "'Roboto Mono', monospace" },
    plex: { main: "'IBM Plex Sans', sans-serif", code: "'IBM Plex Mono', monospace" },
    fira: { main: "'Fira Sans', sans-serif", code: "'Fira Code', monospace" },
    grotesk: { main: "'Space Grotesk', sans-serif", code: "'Roboto Mono', monospace" }
  };
  function changeFont(val) {
    const c = fontMap[val] || fontMap.inter;
    document.documentElement.style.setProperty('--font-main', c.main);
    document.documentElement.style.setProperty('--font-code', c.code);
    localStorage.setItem('fontChoice', val);
  }
  function toggleTheme() {
    document.body.classList.toggle('dark');
    localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
  }
  function toggleToc() {
    const toc = document.querySelector('.toc-container');
    toc.classList.toggle('collapsed');
    document.body.style.paddingLeft = toc.classList.contains('collapsed') ? '60px' : '260px';
    localStorage.setItem('tocCollapsed', toc.classList.contains('collapsed'));
  }
  window.addEventListener('DOMContentLoaded', () => {
    if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');
    const saved = localStorage.getItem('fontChoice') || 'inter';
    document.getElementById('fontSelect').value = saved;
    changeFont(saved);
    const tocCollapsed = localStorage.getItem('tocCollapsed') === 'true';
    if (tocCollapsed) {
      document.querySelector('.toc-container').classList.add('collapsed');
      document.body.style.paddingLeft = '60px';
    }
    const progressBar = document.querySelector('.progress-bar');
    window.addEventListener('scroll', () => {
      const winScroll = document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height) * 100;
      progressBar.style.width = scrolled + '%';
    });
    const technicalTerms = {
      'Potential vulnerabilities': 'If you see vulnerabilities here, please, do a double check. Remember about "potential" word',
      'Subdomains IP addresses': 'This list is not correlated with "Found subdomains" list',
      'Subdomains e-mails': 'This list is not correlated with "Found subdomains" list',
      'Tags': 'Keywords that categorize and describe various technologies or features',
      'CMS': 'Software for managing digital content on a website',
      'Analytics service': 'Tool that monitors and analyzes website visitor behavior, traffic sources, and user engagement metrics',
      'Common Platform Enumeration': 'Standardized naming scheme for identifying and categorizing operating systems, applications and hardware',
      'Hostnames': 'Hostnames are human-readable labels assigned to devices on a network',
      'VIRUSTOTAL API SCAN RESULTS': 'See docs.virustotal.com/docs/results-reports for more details',
      'HUDSONROCK API SCAN RESULTS': 'See docs.hudsonrock.com for more details',
      'SECURITYTRAILS API SCAN RESULTS': 'See docs.securitytrails.com/reference for more details'
    };
    document.body.innerHTML = document.body.innerHTML.replace(
            new RegExp(`\\b(${Object.keys(technicalTerms).join('|')})\\b`, 'g'),
            match => `<span class="technical-term" data-term="${match}">${match}</span>`
    );
    document.querySelectorAll('.technical-term').forEach(term => {
      term.addEventListener('click', () => {
        const definition = technicalTerms[term.dataset.term];
        const tooltip = document.createElement('div');
        tooltip.className = 'term-tooltip';
        tooltip.textContent = definition;
        term.appendChild(tooltip);
        setTimeout(() => tooltip.remove(), 3000);
      });
    });
    document.getElementById('printBtn').addEventListener('click', () => window.print());
    if (window.Chart) {
      const stats = [
        parseInt(document.getElementById('a_tsf')?.textContent) || 0,
        parseInt(document.getElementById('a_tsm')?.textContent) || 0,
        parseInt(document.getElementById('a_temails')?.textContent) || 0,
        parseInt(document.getElementById('a_tips')?.textContent) || 0,
        parseInt(document.getElementById('a_tops')?.textContent) || 0,
        parseInt(document.getElementById('a_tpv')?.textContent) || 0,
        parseInt(document.getElementById('ps_s')?.textContent) || 0,
        parseInt(document.getElementById('ps_e')?.textContent) || 0,
        parseInt(document.getElementById('ps_f')?.textContent) || 0,
        parseInt(document.getElementById('ps_c')?.textContent) || 0,
        parseInt(document.getElementById('ps_a')?.textContent) || 0,
        parseInt(document.getElementById('ps_w')?.textContent) || 0,
        parseInt(document.getElementById('ps_p')?.textContent) || 0
      ];
      const labels = [
        'Subdomains',
        'Social Media',
        'Emails',
        'IP Addresses',
        'Open Ports',
        'Vulnerabilities',
        'Accessible subdomains',
        'Email addresses',
        'Found documents',
        'Found cookies',
        'Found API keys',
        'WEB elements',
        'Exposed passwords'
      ];
      const colors = [
        '#4caf50', '#2196f3', '#ff9800', '#9c27b0', '#f44336', '#607d8b',
        '#00bcd4', '#8bc34a', '#ffc107', '#e91e63', '#3f51b5', '#795548', '#9e9e9e'
      ];
      const ctx = document.getElementById('statsChart')?.getContext('2d');
      if (ctx) {
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Count',
              data: stats,
              backgroundColor: colors
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              title: { display: false }
            },
            scales: {
              y: { beginAtZero: true }
            }
          }
        });
      }
      const socialDiv = document.getElementById('socialCounts');
      const socialCounts = [
        parseInt(socialDiv?.dataset.fb) || 0,
        parseInt(socialDiv?.dataset.tw) || 0,
        parseInt(socialDiv?.dataset.inst) || 0,
        parseInt(socialDiv?.dataset.tg) || 0,
        parseInt(socialDiv?.dataset.tt) || 0,
        parseInt(socialDiv?.dataset.li) || 0,
        parseInt(socialDiv?.dataset.vk) || 0,
        parseInt(socialDiv?.dataset.yt) || 0,
        parseInt(socialDiv?.dataset.ok) || 0,
        parseInt(socialDiv?.dataset.wc) || 0
      ];
      const socialLabels = [
        'Facebook', 'Twitter/X', 'Instagram', 'Telegram', 'TikTok',
        'LinkedIn', 'VK', 'YouTube', 'Odnoklassniki', 'WeChat'
      ];
      const socialColors = [
        '#1877f2', '#1da1f2', '#e1306c', '#0088cc', '#111',
        '#0077b5', '#4a76a8', '#ff0000', '#ff8000', '#7bb32e'
      ];
      let socialPieData = [];
      let socialPieLabels = [];
      let socialPieColors = [];
      for (let i = 0; i < socialCounts.length; ++i) {
        if (socialCounts[i] > 0) {
          socialPieData.push(socialCounts[i]);
          socialPieLabels.push(socialLabels[i]);
          socialPieColors.push(socialColors[i]);
        }
      }
      const ctxPie = document.getElementById('socialPie')?.getContext('2d');
      if (ctxPie && socialPieData.length > 0) {
        new Chart(ctxPie, {
          type: 'pie',
          data: {
            labels: socialPieLabels,
            datasets: [{
              data: socialPieData,
              backgroundColor: socialPieColors
            }]
          },
          options: {
            plugins: {
              legend: { position: 'bottom' },
              title: { display: true, text: 'Social Media Links Distribution' }
            }
          }
        });
      }
    }
    if (window.vis && document.getElementById('osintNetwork')) {
      let nodes, edges, network, expanded, initialNodes, initialEdges, selectedNode = null, clusters = [];
      const domain = '{{ sh_domain }}';
      const services = [
        {name: 'Web servers', items: [{% for ws in web_servers %}'{{ ws }}',{% endfor %}]},
      {name: 'CMS', items: [{% for cm in cms %}'{{ cm }}',{% endfor %}]},
      {name: 'Used programming languages', items: [{% for pl in programming_languages %}'{{ pl }}',{% endfor %}]},
      {name: 'Used web frameworks', items: [{% for wf in web_frameworks %}'{{ wf }}',{% endfor %}]},
      {name: 'Analytics service', items: [{% for analytic in analytics %}'{{ analytic }}',{% endfor %}]},
      {name: 'Used JavaScript frameworks', items: [{% for jsf in javascript_frameworks %}'{{ jsf }}',{% endfor %}]},
      {name: 'Tags', items: [{% for tag in tags %}'{{ tag }}',{% endfor %}]},
      {name: 'Common Platform Enumeration', items: [{% for cpe in cpes %}'{{ cpe }}',{% endfor %}]}
    ];
      const subdomains = [{% for sub in subdomains %}'{{ sub }}',{% endfor %}];
      const subdomainIPs = [{% for ip in subdomain_ips %}'{{ ip }}',{% endfor %}];
      const socialGroups = [
        {name: 'Facebook', links: [{% for link in fb_links %}'{{ link }}',{% endfor %}]},
      {name: 'Twitter/X', links: [{% for link in tw_links %}'{{ link }}',{% endfor %}{% for link in xcom_links %}'{{ link }}',{% endfor %}]},
      {name: 'Instagram', links: [{% for link in inst_links %}'{{ link }}',{% endfor %}]},
      {name: 'Telegram', links: [{% for link in tg_links %}'{{ link }}',{% endfor %}]},
      {name: 'TikTok', links: [{% for link in tt_links %}'{{ link }}',{% endfor %}]},
      {name: 'LinkedIn', links: [{% for link in li_links %}'{{ link }}',{% endfor %}]},
      {name: 'VK', links: [{% for link in vk_links %}'{{ link }}',{% endfor %}]},
      {name: 'YouTube', links: [{% for link in yt_links %}'{{ link }}',{% endfor %}]},
      {name: 'Odnoklassniki', links: [{% for link in ok_links %}'{{ link }}',{% endfor %}]},
      {name: 'WeChat', links: [{% for link in wc_links %}'{{ link }}',{% endfor %}]}
    ];
      const ipAddresses = [{% for ip in ip_addresses %}'{{ ip }}',{% endfor %}];
      const ports = [{% for op in ports %}'{{ op }}',{% endfor %}];
      const vulns = [{% for vuln in vulns %}'{{ vuln }}',{% endfor %}];
      function nodeExists(id) { return !!nodes.get(id); }
      function edgeExists(from, to) {
        return edges.get().some(e => e.from === from && e.to === to);
      }
      function initGraph() {
        nodes = new vis.DataSet([
          {id: 'domain', label: domain, group: 'domain', color:'#3F51B5', level:0, size:40, borderWidth:4, shape:'dot', title: 'Main domain'}
        ]);
        edges = new vis.DataSet([]);
        expanded = {};
        const firstLevel = [
          {id: 'services', label: 'SERVICES', color:'#607D8B'},
          {id: 'subdomains', label: `SUBDOMAINS (${subdomains.length})`, color:'#2196F3'},
          {id: 'social', label: 'SOCIALS', color:'#E91E63'},
          {id: 'ip', label: `IPs (${ipAddresses.length})`, color:'#009688'},
          {id: 'ports', label: `PORTS (${ports.length})`, color:'#FB8C00'},
          {id: 'vulns', label: `VULNERABILITIES (${vulns.length})`, color:'#F44336'}
        ];
        firstLevel.forEach(n => {
          if (!nodeExists(n.id)) nodes.add({id: n.id, label: n.label, group: n.id, color: n.color, level:1, size:30, borderWidth:3, shape:'dot', title: n.label});
          if (!edgeExists('domain', n.id)) edges.add({id: 'e_'+n.id, from: 'domain', to: n.id});
        });
        initialNodes = nodes.get().map(n => Object.assign({}, n));
        initialEdges = edges.get().map(e => Object.assign({}, e));
      }
      function expandNode(nodeId) {
        if (expanded[nodeId]) return;
        expanded[nodeId] = true;
        if (nodeId === 'services') {
          services.forEach((srv, i) => {
            const sid = 'srv_' + i;
            if (!nodeExists(sid)) nodes.add({id: sid, label: `${srv.name} (${srv.items.length})`, group:'service', color:'#90caf9', level:2, parent: nodeId, size:20, borderWidth:2, shape:'dot', title: srv.name});
            if (!edgeExists('services', sid)) edges.add({id: 'e_services_'+sid, from: 'services', to: sid});
          });
        }
        if (nodeId.startsWith('srv_')) {
          const idx = parseInt(nodeId.split('_')[1]);
          services[idx].items.forEach((item, j) => {
            const iid = nodeId + '_item_' + j;
            if (!nodeExists(iid)) nodes.add({id: iid, label: item.length>30?item.slice(0,27)+'...':item, group:'serviceitem', color:'#b3e5fc', level:3, parent: nodeId, size:12, borderWidth:1, shape:'box', title: item});
            if (!edgeExists(nodeId, iid)) edges.add({id: 'e_'+nodeId+'_'+iid, from: nodeId, to: iid});
          });
        }
        if (nodeId === 'subdomains') {
          subdomains.forEach((sub, i) => {
            const sid = 'sub_' + i;
            if (!nodeExists(sid)) nodes.add({id: sid, label: sub, group:'subdomain', color:'#64b5f6', level:2, parent: nodeId, size:20, borderWidth:2, shape:'ellipse', title: sub});
            if (!edgeExists('subdomains', sid)) edges.add({id: 'e_subdomains_'+sid, from: 'subdomains', to: sid});
            if (subdomainIPs[i]) {
              const ipid = 'ip_sub_' + i;
              if (!nodeExists(ipid)) nodes.add({id: ipid, label: subdomainIPs[i], group:'ip', color:'#80cbc4', level:3, parent: sid, size:14, borderWidth:1, shape:'dot', title: subdomainIPs[i]});
              if (!edgeExists(sid, ipid)) edges.add({id: 'e_'+sid+'_'+ipid, from: sid, to: ipid});
            }
          });
        }
        if (nodeId === 'social') {
          socialGroups.forEach((sg, i) => {
            if (sg.links.length > 0) {
              const gid = 'soc_' + i;
              if (!nodeExists(gid)) nodes.add({id: gid, label: `${sg.name} (${sg.links.length})`, group:'socialgroup', color:'#f06292', level:2, parent: nodeId, size:20, borderWidth:2, shape:'dot', title: sg.name});
              if (!edgeExists('social', gid)) edges.add({id: 'e_social_'+gid, from: 'social', to: gid});
            }
          });
        }
        if (nodeId.startsWith('soc_')) {
          const idx = parseInt(nodeId.split('_')[1]);
          socialGroups[idx].links.forEach((link, j) => {
            const lid = nodeId + '_link_' + j;
            if (!nodeExists(lid)) nodes.add({id: lid, label: 'üîó', title: link, group:'sociallink', color:'#f8bbd0', level:3, shape:'icon', icon: {face: 'FontAwesome', code: '\uf0c1', size: 30, color: '#f8bbd0'}, parent: nodeId, size:12, borderWidth:1});
            if (!edgeExists(nodeId, lid)) edges.add({id: 'e_'+nodeId+'_'+lid, from: nodeId, to: lid});
          });
        }
        if (nodeId === 'ip') {
          ipAddresses.forEach((ip, i) => {
            const iid = 'ip_' + i;
            if (!nodeExists(iid)) nodes.add({id: iid, label: ip, group:'ip', color:'#80cbc4', level:2, parent: nodeId, size:20, borderWidth:2, shape:'dot', title: ip});
            if (!edgeExists('ip', iid)) edges.add({id: 'e_ip_'+iid, from: 'ip', to: iid});
          });
        }
        if (nodeId === 'ports') {
          ports.forEach((port, i) => {
            const pid = 'port_' + i;
            if (!nodeExists(pid)) nodes.add({id: pid, label: port, group:'port', color:'#ffe082', level:2, parent: nodeId, size:20, borderWidth:2, shape:'box', title: port});
            if (!edgeExists('ports', pid)) edges.add({id: 'e_ports_'+pid, from: 'ports', to: pid});
          });
        }
        if (nodeId === 'vulns') {
          vulns.forEach((vuln, i) => {
            const vid = 'vuln_' + i;
            if (!nodeExists(vid)) nodes.add({id: vid, label: vuln.length>30?vuln.slice(0,27)+'...':vuln, group:'vuln', color:'#ef9a9a', level:2, parent: nodeId, size:20, borderWidth:2, shape:'box', title: vuln});
            if (!edgeExists('vulns', vid)) edges.add({id: 'e_vulns_'+vid, from: 'vulns', to: vid});
          });
        }
      }
      function collapseNode(nodeId) {
        let toRemove = [];
        nodes.get().forEach(n => {
          if (n.parent === nodeId) {
            toRemove.push(n.id);
            collapseNode(n.id);
          }
        });
        toRemove.forEach(id => {
          edges.get().forEach(e => {
            if (e.from === id || e.to === id) edges.remove(e.id);
          });
          nodes.remove(id);
          expanded[id] = false;
        });
        expanded[nodeId] = false;
      }
      function resetGraph() {
        nodes.clear();
        edges.clear();
        initialNodes.forEach(n => nodes.add(Object.assign({}, n)));
        initialEdges.forEach(e => edges.add(Object.assign({}, e)));
        for (let k in expanded) expanded[k] = false;
        selectedNode = null;
        clusters = [];
        document.getElementById('collapseBtn').disabled = true;
      }
      function expandAll() {
        ['services','subdomains','social','ip','ports','vulns'].forEach(expandNode);
        for (let i=0; i<services.length; ++i) expandNode('srv_'+i);
        for (let i=0; i<socialGroups.length; ++i) expandNode('soc_'+i);
      }
      function clusterSubdomains() {
        if (!network) return;
        network.cluster({
          joinCondition: function(nodeOptions) {
            return nodeOptions.group === 'subdomain';
          },
          clusterNodeProperties: {
            id: 'cluster:subdomains',
            label: `Subdomains (${subdomains.length})`,
            borderWidth: 3,
            color: '#2196F3',
            shape: 'database',
            font: {size: 18, color: '#fff'},
            allowSingleNodeCluster: true
          }
        });
        clusters.push('cluster:subdomains');
      }
      function unclusterAll() {
        if (!network) return;
        network.openCluster('cluster:subdomains');
        clusters = [];
      }
      function saveGraphState() {
        localStorage.setItem('osintGraphNodes', JSON.stringify(nodes.get()));
        localStorage.setItem('osintGraphEdges', JSON.stringify(edges.get()));
        localStorage.setItem('osintGraphExpanded', JSON.stringify(expanded));
      }
      function loadGraphState() {
        let n = localStorage.getItem('osintGraphNodes');
        let e = localStorage.getItem('osintGraphEdges');
        let ex = localStorage.getItem('osintGraphExpanded');
        if (n && e && ex) {
          nodes.clear(); edges.clear();
          JSON.parse(n).forEach(x => nodes.add(x));
          JSON.parse(e).forEach(x => edges.add(x));
          expanded = JSON.parse(ex);
        }
      }
      initGraph();
      var container = document.getElementById('osintNetwork');
      var data = { nodes: nodes, edges: edges };
      var options = {
        layout: { hierarchical: false },
        nodes: { font: { size: 16 }, shape: 'dot' },
        physics: { stabilization: true },
        interaction: { hover: true, navigationButtons: true, keyboard: true, dragNodes: true }
      };
      network = new vis.Network(container, data, options);
      window.network = network;
      network.on("click", function (params) {
        if (params.nodes.length === 1) {
          selectedNode = params.nodes[0];
          document.getElementById('collapseBtn').disabled = false;
          expandNode(selectedNode);
          network.setData({nodes: nodes, edges: edges});
          network.focus(selectedNode, {animation: {duration: 500, easingFunction: "easeInOutQuad"}});
          saveGraphState();
        } else {
          selectedNode = null;
          document.getElementById('collapseBtn').disabled = true;
        }
      });
      network.on("doubleClick", function(params) {
        if (params.nodes.length === 1) {
          collapseNode(params.nodes[0]);
          network.setData({nodes: nodes, edges: edges});
          saveGraphState();
        }
      });
      document.getElementById('resetGraphBtn').onclick = function() {
        resetGraph();
        network.setData({nodes: nodes, edges: edges});
        network.fit({animation: {duration: 500, easingFunction: "easeInOutQuad"}});
        saveGraphState();
      };
      document.getElementById('collapseBtn').onclick = function() {
        if (selectedNode) {
          collapseNode(selectedNode);
          network.setData({nodes: nodes, edges: edges});
          document.getElementById('collapseBtn').disabled = true;
          network.fit({animation: {duration: 500, easingFunction: "easeInOutQuad"}});
          saveGraphState();
        }
      };
      document.getElementById('expandAllBtn').onclick = function() {
        expandAll();
        network.setData({nodes: nodes, edges: edges});
        network.fit({animation: {duration: 500, easingFunction: "easeInOutQuad"}});
        saveGraphState();
      };
      document.getElementById('clusterBtn').onclick = function() {
        clusterSubdomains();
      };
      document.getElementById('unclusterBtn').onclick = function() {
        unclusterAll();
      };
      document.getElementById('graphSearchBtn').onclick = function() {
        let val = document.getElementById('graphSearchInput').value.trim().toLowerCase();
        if (!val) return;
        let found = nodes.get().filter(n => n.label && n.label.toLowerCase().includes(val));
        if (found.length > 0) {
          network.selectNodes([found[0].id]);
          network.focus(found[0].id, {animation: {duration: 500}});
        }
      };
      document.getElementById('graphClearBtn').onclick = function() {
        document.getElementById('graphSearchInput').value = '';
        network.unselectAll();
      };
      document.getElementById('exportPngBtn').onclick = function() {
        let canvas = document.querySelector('#osintNetwork canvas');
        if (!canvas) return;
        let url = canvas.toDataURL('image/png');
        let a = document.createElement('a');
        a.href = url;
        a.download = 'dpulse_osint_graph.png';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      };
      loadGraphState();
      network.setData({nodes: nodes, edges: edges});
      var graphDiv = document.getElementById('osintNetwork');
      var btnFS = document.getElementById('fullscreenGraphBtn');
      var btnExit = document.getElementById('exitFullscreenBtn');
      if (graphDiv && btnFS && btnExit) {
        btnFS.onclick = function() {
          graphDiv.classList.add('fullscreen');
          document.body.classList.add('fullscreen-graph');
          btnExit.style.display = 'block';
          if (window.network) setTimeout(() => window.network.fit(), 200);
        };
        btnExit.onclick = function() {
          graphDiv.classList.remove('fullscreen');
          document.body.classList.remove('fullscreen-graph');
          btnExit.style.display = 'none';
          if (window.network) setTimeout(() => window.network.fit(), 200);
        };
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && graphDiv.classList.contains('fullscreen')) {
            graphDiv.classList.remove('fullscreen');
            document.body.classList.remove('fullscreen-graph');
            btnExit.style.display = 'none';
            if (window.network) setTimeout(() => window.network.fit(), 200);
          }
        });
      }
    }
  });
</script>
</body>
</html>
