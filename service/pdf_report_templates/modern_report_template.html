<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>OSINT Report for {{ sh_domain }}</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono&family=IBM+Plex+Sans:wght@400;600&family=IBM+Plex+Mono&family=Fira+Sans:wght@400;600&family=Fira+Code&family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/umd/simple-datatables.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style media="print">
    @page { size: A4; margin: 20mm; }
    body { padding:0!important; background:#fff!important; color:#000!important; }
    .control-panel, .toc-container, .back-to-top, #graph-filters, #graph-search, #graph-export, #graph-stats, #nodeInfoPanel, #graphContextMenu, .table-toolbar, .info-card-actions { display:none!important; }
    h1,h2,h3 { page-break-after:avoid; }
    section { page-break-inside:avoid; }
    .info-card { box-shadow:none!important; border:1px solid #ccc!important; }
  </style>
  <style>
    :root {
      --bg-color:#f8fafc;
      --bg-secondary:#ffffff;
      --text-color:#1e293b;
      --text-secondary:#64748b;
      --link-color:#3b82f6;
      --accent-color:#6366f1;
      --accent-light:#818cf8;
      --accent-gradient:linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      --success-color:#10b981;
      --warning-color:#f59e0b;
      --danger-color:#ef4444;
      --hr-color:#e2e8f0;
      --card-shadow:0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
      --card-shadow-hover:0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1);
      --font-main:'Inter',system-ui,-apple-system,sans-serif;
      --font-code:'Roboto Mono','Fira Code',monospace;
      --border-radius:12px;
      --border-radius-sm:8px;
    }
    body.dark {
      --bg-color:#0f172a;
      --bg-secondary:#1e293b;
      --text-color:#e2e8f0;
      --text-secondary:#94a3b8;
      --link-color:#60a5fa;
      --accent-color:#818cf8;
      --accent-light:#a5b4fc;
      --hr-color:#334155;
      --card-shadow:0 4px 6px -1px rgba(0,0,0,0.3), 0 2px 4px -2px rgba(0,0,0,0.2);
    }
    *,*::before,*::after { margin:0; padding:0; box-sizing:border-box; }
    html { scroll-behavior:smooth; }
    body {
      font:15px/1.7 var(--font-main);
      background:var(--bg-color);
      color:var(--text-color);
      padding:24px 24px 24px 280px;
      transition:all 0.3s ease;
    }

    h1,h2,h3 { font-weight:700; font-family:var(--font-main); margin:0 0 16px; }
    h1 { font-size:32px; text-align:center; background:var(--accent-gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; margin-bottom:8px; }
    h2 { font-size:24px; text-align:center; color:var(--text-secondary); font-weight:600; }
    h3 { font-size:20px; margin-top:32px; margin-bottom:20px; display:flex; align-items:center; gap:12px; }
    h3::before { content:''; flex:1; height:2px; background:linear-gradient(90deg, var(--accent-color), transparent); }
    h3::after { content:''; flex:1; height:2px; background:linear-gradient(90deg, transparent, var(--accent-color)); }
    p { margin:0 0 12px; line-height:1.7; }
    ul { margin:8px 0 16px 0; padding-left:0; list-style:none; }
    li { margin:6px 0; padding-left:24px; position:relative; }
    li::before { content:'‚Ä∫'; position:absolute; left:8px; color:var(--accent-color); font-weight:bold; }
    hr { margin:32px 0; border:none; height:1px; background:linear-gradient(90deg, transparent, var(--hr-color), transparent); }
    pre,code { font-family:var(--font-code); }
    code { background:rgba(99,102,241,0.1); color:var(--accent-color); padding:2px 8px; border-radius:4px; font-size:13px; }
    pre { background:var(--bg-secondary); border:1px solid var(--hr-color); border-radius:var(--border-radius-sm); padding:16px; overflow-x:auto; font-size:13px; line-height:1.6; }
    a { color:var(--link-color); text-decoration:none; transition:all 0.2s; }
    a:hover { color:var(--accent-color); text-decoration:underline; }

    .progress-bar {
      position:fixed;
      top:0;
      left:0;
      width:0;
      height:4px;
      background:var(--accent-gradient);
      z-index:1001;
      transition:width 0.2s;
    }

    .control-panel {
      position:fixed;
      top:16px;
      right:24px;
      z-index:1000;
      display:flex;
      gap:8px;
      background:var(--bg-secondary);
      padding:12px 16px;
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius);
      box-shadow:var(--card-shadow);
    }
    .control-btn {
      background:var(--bg-color);
      color:var(--text-color);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius-sm);
      padding:8px 14px;
      font-family:var(--font-main);
      font-size:13px;
      font-weight:500;
      cursor:pointer;
      transition:all 0.2s;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .control-btn:hover { background:var(--accent-color); color:#fff; border-color:var(--accent-color); transform:translateY(-1px); }
    .font-select {
      background:var(--bg-color);
      color:var(--text-color);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius-sm);
      padding:8px 12px;
      font-family:var(--font-main);
      font-size:13px;
      cursor:pointer;
    }

    .toc-container {
      position:fixed;
      top:0;
      left:0;
      width:260px;
      height:100vh;
      overflow-y:auto;
      background:var(--bg-secondary);
      border-right:1px solid var(--hr-color);
      padding:20px 12px;
      font-family:var(--font-main);
      transition:all 0.3s ease;
      z-index:999;
    }
    .toc-container::-webkit-scrollbar { width:6px; }
    .toc-container::-webkit-scrollbar-track { background:transparent; }
    .toc-container::-webkit-scrollbar-thumb { background:var(--hr-color); border-radius:3px; }
    .toc-container.collapsed { width:60px; }
    .toc-container.collapsed .toc-section-title,
    .toc-container.collapsed .toc-link,
    .toc-container.collapsed .toc-header { opacity:0; visibility:hidden; pointer-events:none; }
    .toc-toggle {
      position:absolute;
      top:16px;
      right:12px;
      background:var(--accent-gradient);
      border:none;
      border-radius:var(--border-radius-sm);
      width:32px;
      height:32px;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      color:#fff;
      font-size:14px;
      transition:all 0.2s;
    }
    .toc-toggle:hover { transform:scale(1.1); }
    .toc-header { text-align:center; margin:40px 0 20px; font-size:14px; font-weight:700; color:var(--accent-color); text-transform:uppercase; letter-spacing:1px; }
    .toc-section-title {
      font-size:11px;
      font-weight:700;
      color:var(--text-secondary);
      text-transform:uppercase;
      letter-spacing:0.5px;
      margin:20px 0 10px 8px;
      padding-bottom:6px;
      border-bottom:1px dashed var(--hr-color);
    }
    .toc-link {
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      margin:4px 0;
      color:var(--text-color);
      text-decoration:none;
      font-size:13px;
      font-weight:500;
      border-radius:var(--border-radius-sm);
      transition:all 0.2s;
    }
    .toc-link:hover { background:rgba(99,102,241,0.1); color:var(--accent-color); transform:translateX(4px); text-decoration:none; }
    .toc-link.active { background:var(--accent-gradient); color:#fff; }
    .toc-link i { width:18px; text-align:center; font-size:14px; }

    .info-cards-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));
      gap:16px;
      margin:20px 0;
    }
    .info-card {
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius);
      padding:20px;
      box-shadow:var(--card-shadow);
      transition:all 0.3s ease;
    }
    .info-card:hover { box-shadow:var(--card-shadow-hover); transform:translateY(-2px); }
    .info-card-header {
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:16px;
      padding-bottom:12px;
      border-bottom:1px solid var(--hr-color);
    }
    .info-card-icon {
      width:40px;
      height:40px;
      border-radius:var(--border-radius-sm);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
      color:#fff;
    }
    .info-card-title { font-size:14px; font-weight:600; color:var(--text-secondary); text-transform:uppercase; letter-spacing:0.5px; }
    .info-card-value { font-size:15px; font-weight:600; color:var(--text-color); word-break:break-all; }
    .info-card-value a { color:var(--link-color); }
    .info-row { display:flex; justify-content:space-between; align-items:flex-start; padding:10px 0; border-bottom:1px dashed var(--hr-color); }
    .info-row:last-child { border-bottom:none; }
    .info-label { font-size:13px; color:var(--text-secondary); display:flex; align-items:center; gap:8px; }
    .info-value { font-size:14px; font-weight:500; color:var(--text-color); text-align:right; max-width:60%; word-break:break-all; }

    .stats-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
      gap:16px;
      margin:24px 0;
    }
    .stat-card {
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius);
      padding:20px;
      text-align:center;
      box-shadow:var(--card-shadow);
      transition:all 0.3s;
      position:relative;
      overflow:hidden;
    }
    .stat-card::before {
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:4px;
      background:var(--accent-gradient);
    }
    .stat-card:hover { transform:translateY(-4px); box-shadow:var(--card-shadow-hover); }
    .stat-card-icon { font-size:28px; margin-bottom:12px; }
    .stat-card-value { font-size:32px; font-weight:700; color:var(--accent-color); margin-bottom:4px; }
    .stat-card-label { font-size:13px; color:var(--text-secondary); font-weight:500; }

    .section-card {
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius);
      padding:24px;
      margin:24px 0;
      box-shadow:var(--card-shadow);
    }
    .section-card-header {
      display:flex;
      align-items:center;
      gap:16px;
      margin-bottom:20px;
      padding-bottom:16px;
      border-bottom:2px solid var(--hr-color);
    }
    .section-card-icon {
      width:48px;
      height:48px;
      border-radius:var(--border-radius-sm);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:22px;
      color:#fff;
    }
    .section-card-title { font-size:18px; font-weight:700; color:var(--text-color); }
    .section-card-subtitle { font-size:13px; color:var(--text-secondary); margin-top:4px; }

    .list-card {
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius);
      margin:16px 0;
      overflow:hidden;
    }
    .list-card-header {
      background:var(--accent-gradient);
      color:#fff;
      padding:14px 20px;
      font-size:14px;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .list-card-body { padding:16px 20px; }
    .list-card-item {
      display:flex;
      align-items:center;
      gap:12px;
      padding:10px 0;
      border-bottom:1px dashed var(--hr-color);
      font-size:14px;
    }
    .list-card-item:last-child { border-bottom:none; }
    .list-card-item::before { content:''; display:none; }
    .list-card-item i { color:var(--accent-color); width:20px; text-align:center; }
    .list-card-empty { color:var(--text-secondary); font-style:italic; text-align:center; padding:20px; }

    details {
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius);
      margin:16px 0;
      overflow:hidden;
      transition:all 0.3s;
    }
    details:hover { box-shadow:var(--card-shadow); }
    details[open] { border-color:var(--accent-color); }
    details > summary {
      padding:16px 20px;
      cursor:pointer;
      user-select:none;
      font-weight:600;
      display:flex;
      align-items:center;
      gap:12px;
      background:linear-gradient(135deg, rgba(99,102,241,0.05) 0%, rgba(139,92,246,0.05) 100%);
      transition:all 0.2s;
    }
    details > summary:hover { background:linear-gradient(135deg, rgba(99,102,241,0.1) 0%, rgba(139,92,246,0.1) 100%); }
    details > summary::after { content:'‚ñº'; margin-left:auto; font-size:12px; color:var(--text-secondary); transition:transform 0.3s; }
    details[open] > summary::after { transform:rotate(180deg); }
    details > summary::-webkit-details-marker { display:none; }
    details > pre { margin:0; border:none; border-top:1px solid var(--hr-color); border-radius:0; }

    .table-wrapper {
      margin:24px 0;
      font-family:var(--font-main);
    }
    .table-toolbar {
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      padding:16px 20px;
      border-radius:var(--border-radius) var(--border-radius) 0 0;
      align-items:center;
    }
    .toolbar-primary { background:var(--accent-gradient); }
    .toolbar-success { background:linear-gradient(135deg, #10b981 0%, #34d399 100%); }
    .toolbar-warning { background:linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%); }
    .toolbar-danger { background:linear-gradient(135deg, #ef4444 0%, #f87171 100%); }
    .toolbar-info { background:linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); }
    .toolbar-purple { background:linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%); }
    
    .table-toolbar button {
      padding:8px 16px;
      border:none;
      border-radius:var(--border-radius-sm);
      background:rgba(255,255,255,0.95);
      color:#1e293b;
      cursor:pointer;
      font-weight:600;
      font-size:13px;
      transition:all 0.2s;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .table-toolbar button:hover { background:#fff; transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.15); }
    .table-toolbar button:disabled { opacity:0.5; cursor:not-allowed; transform:none; }
    .table-toolbar select {
      padding:8px 14px;
      border:none;
      border-radius:var(--border-radius-sm);
      background:rgba(255,255,255,0.95);
      color:#1e293b;
      font-size:13px;
      font-weight:500;
      cursor:pointer;
    }
    .selected-count {
      background:rgba(255,255,255,0.2);
      padding:6px 14px;
      border-radius:20px;
      font-size:13px;
      color:#fff;
      font-weight:600;
      margin-left:auto;
    }

    .dataTable-wrapper {
      border-radius:0 0 var(--border-radius) var(--border-radius);
      overflow:hidden;
      box-shadow:var(--card-shadow);
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-top:none;
    }
    .dataTable-top {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:16px 20px;
      background:var(--bg-color);
      border-bottom:1px solid var(--hr-color);
      flex-wrap:wrap;
      gap:12px;
    }
    .dataTable-search { position:relative; }
    .dataTable-input {
      padding:10px 16px 10px 42px;
      border:2px solid var(--hr-color);
      border-radius:var(--border-radius-sm);
      font-size:14px;
      background:var(--bg-secondary);
      color:var(--text-color);
      width:280px;
      transition:all 0.2s;
    }
    .dataTable-input:focus { border-color:var(--accent-color); box-shadow:0 0 0 3px rgba(99,102,241,0.1); outline:none; }
    .dataTable-search::before { content:"üîç"; position:absolute; left:14px; top:50%; transform:translateY(-50%); font-size:14px; }
    .dataTable-selector {
      padding:10px 14px;
      border:2px solid var(--hr-color);
      border-radius:var(--border-radius-sm);
      background:var(--bg-secondary);
      color:var(--text-color);
      font-size:14px;
      cursor:pointer;
    }
    .dataTable-table {
      width:100%;
      border-collapse:collapse;
      background:var(--bg-secondary);
    }
    .dataTable-table thead th {
      background:var(--accent-gradient);
      color:#fff;
      padding:14px 16px;
      text-align:left;
      font-weight:600;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:0.5px;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
      position:relative;
    }
    .dataTable-table thead th:hover { background:linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); }
    .dataTable-table thead th::after { content:'‚áÖ'; position:absolute; right:10px; opacity:0.5; font-size:11px; }
    .dataTable-table thead th.asc::after { content:'‚ñ≤'; opacity:1; }
    .dataTable-table thead th.desc::after { content:'‚ñº'; opacity:1; }
    .dataTable-table tbody td {
      padding:14px 16px;
      border-bottom:1px solid var(--hr-color);
      font-size:14px;
      vertical-align:middle;
    }
    .dataTable-table tbody tr { transition:all 0.2s; }
    .dataTable-table tbody tr:hover { background:rgba(99,102,241,0.05); }
    .dataTable-table tbody tr.selected { background:rgba(99,102,241,0.1); }
    .dataTable-table tbody tr:last-child td { border-bottom:none; }
    .dataTable-bottom {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:16px 20px;
      background:var(--bg-color);
      border-top:1px solid var(--hr-color);
      flex-wrap:wrap;
      gap:12px;
    }
    .dataTable-info { color:var(--text-secondary); font-size:13px; }
    .dataTable-pagination { display:flex; gap:4px; }
    .dataTable-pagination button, .dataTable-pagination a {
      padding:8px 14px;
      border:1px solid var(--hr-color);
      background:var(--bg-secondary);
      color:var(--text-color);
      cursor:pointer;
      border-radius:var(--border-radius-sm);
      text-decoration:none;
      font-size:13px;
      font-weight:500;
      transition:all 0.2s;
    }
    .dataTable-pagination button:hover, .dataTable-pagination a:hover { background:var(--accent-color); color:#fff; border-color:var(--accent-color); }
    .dataTable-pagination a.active { background:var(--accent-color); color:#fff; border-color:var(--accent-color); }
    .dataTable-pagination button:disabled, .dataTable-pagination a.disabled { opacity:0.4; cursor:not-allowed; }

    .status-badge {
      display:inline-flex;
      align-items:center;
      gap:5px;
      padding:5px 12px;
      border-radius:20px;
      font-size:11px;
      font-weight:600;
      color:#fff;
      text-transform:uppercase;
      letter-spacing:0.3px;
    }
    .status-active { background:linear-gradient(135deg, #10b981, #34d399); }
    .status-inactive { background:linear-gradient(135deg, #ef4444, #f87171); }
    .status-unknown { background:linear-gradient(135deg, #94a3b8, #cbd5e1); color:#475569; }
    .status-checking { background:linear-gradient(135deg, #f59e0b, #fbbf24); animation:pulse 1.5s infinite; }
    .status-ssl-valid { background:linear-gradient(135deg, #3b82f6, #60a5fa); }
    .status-ssl-invalid { background:linear-gradient(135deg, #ef4444, #f87171); }
    .risk-critical { background:linear-gradient(135deg, #991b1b, #dc2626) !important; animation:pulse 2s infinite; }
    .risk-high { background:linear-gradient(135deg, #c2410c, #ea580c) !important; }
    .risk-medium { background:linear-gradient(135deg, #ca8a04, #eab308) !important; color:#1e293b !important; }
    .risk-low { background:linear-gradient(135deg, #15803d, #22c55e) !important; }
    @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.7;} }

    .table-actions { display:flex; gap:6px; flex-wrap:wrap; }
    .action-btn {
      padding:6px 10px;
      border:1px solid var(--hr-color);
      background:var(--bg-color);
      border-radius:var(--border-radius-sm);
      cursor:pointer;
      font-size:12px;
      transition:all 0.2s;
      display:flex;
      align-items:center;
      gap:4px;
      color:var(--text-color);
    }
    .action-btn:hover { background:var(--accent-color); color:#fff; border-color:var(--accent-color); transform:translateY(-1px); }
    .table-checkbox {
      width:18px;
      height:18px;
      cursor:pointer;
      accent-color:var(--accent-color);
    }
    .code-cell {
      font-family:var(--font-code);
      background:rgba(99,102,241,0.1);
      color:var(--accent-color);
      padding:4px 10px;
      border-radius:4px;
      font-size:13px;
      font-weight:500;
    }
    .table-link { color:var(--link-color); font-weight:500; transition:all 0.2s; }
    .table-link:hover { color:var(--accent-color); }
    .tech-tag {
      display:inline-block;
      padding:3px 10px;
      background:var(--accent-gradient);
      color:#fff;
      border-radius:12px;
      font-size:11px;
      font-weight:600;
    }
    .loading-spinner {
      display:inline-block;
      width:14px;
      height:14px;
      border:2px solid rgba(255,255,255,0.3);
      border-top-color:#fff;
      border-radius:50%;
      animation:spin 0.8s linear infinite;
    }
    @keyframes spin { to{transform:rotate(360deg);} }
    .empty-state {
      color:var(--text-secondary);
      font-style:italic;
      text-align:center;
      padding:48px 24px;
      font-size:15px;
    }

    .tooltip { position:relative; }
    .tooltip .tooltiptext {
      visibility:hidden;
      width:160px;
      background:var(--bg-secondary);
      color:var(--text-color);
      text-align:center;
      border-radius:var(--border-radius-sm);
      padding:8px 12px;
      position:absolute;
      z-index:1000;
      bottom:calc(100% + 8px);
      left:50%;
      transform:translateX(-50%);
      opacity:0;
      transition:all 0.2s;
      font-size:12px;
      font-weight:500;
      box-shadow:var(--card-shadow);
      border:1px solid var(--hr-color);
    }
    .tooltip .tooltiptext::after {
      content:'';
      position:absolute;
      top:100%;
      left:50%;
      margin-left:-6px;
      border-width:6px;
      border-style:solid;
      border-color:var(--bg-secondary) transparent transparent transparent;
    }
    .tooltip:hover .tooltiptext { visibility:visible; opacity:1; }

    .back-to-top { text-align:right; margin-top:20px; }
    .back-to-top a {
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:8px 16px;
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius-sm);
      font-size:13px;
      font-weight:500;
      transition:all 0.2s;
    }
    .back-to-top a:hover { background:var(--accent-color); color:#fff; border-color:var(--accent-color); text-decoration:none; }

    #graph-stats {
      display:flex;
      justify-content:center;
      gap:16px;
      margin:16px auto;
      padding:16px 24px;
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius);
      max-width:900px;
      flex-wrap:wrap;
    }
    .graph-stat-item {
      display:flex;
      align-items:center;
      gap:8px;
      font-size:14px;
      font-weight:500;
      padding:8px 16px;
      background:var(--bg-color);
      border-radius:var(--border-radius-sm);
    }
    .graph-stat-item strong { color:var(--accent-color); font-size:16px; }
    #graph-legend {
      margin:16px auto;
      max-width:900px;
      display:flex;
      flex-wrap:wrap;
      gap:16px;
      justify-content:center;
      padding:16px;
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius);
    }
    .legend-item { display:flex; align-items:center; gap:8px; font-size:13px; font-weight:500; }
    .legend-dot { width:16px; height:16px; border-radius:50%; border:2px solid rgba(0,0,0,0.2); }
    #graph-filters {
      display:flex;
      justify-content:center;
      gap:10px;
      margin:16px auto;
      flex-wrap:wrap;
      max-width:900px;
    }
    .filter-checkbox {
      display:flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      padding:8px 14px;
      border-radius:var(--border-radius-sm);
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      transition:all 0.2s;
      font-size:13px;
      font-weight:500;
    }
    .filter-checkbox:hover { border-color:var(--accent-color); }
    .filter-checkbox input { cursor:pointer; accent-color:var(--accent-color); }
    #graph-search {
      margin:16px auto;
      display:flex;
      justify-content:center;
      gap:8px;
      position:relative;
      flex-wrap:wrap;
      max-width:600px;
    }
    #graph-search input {
      flex:1;
      min-width:200px;
      padding:12px 16px;
      border-radius:var(--border-radius-sm);
      border:2px solid var(--hr-color);
      font-size:14px;
      background:var(--bg-secondary);
      color:var(--text-color);
      transition:all 0.2s;
    }
    #graph-search input:focus { border-color:var(--accent-color); outline:none; }
    #graph-search button, #graph-export button, .graph-control-btn {
      padding:10px 16px;
      border-radius:var(--border-radius-sm);
      border:1px solid var(--hr-color);
      background:var(--bg-secondary);
      color:var(--text-color);
      cursor:pointer;
      font-size:13px;
      font-weight:500;
      transition:all 0.2s;
      display:flex;
      align-items:center;
      gap:6px;
    }
    #graph-search button:hover, #graph-export button:hover, .graph-control-btn:hover {
      background:var(--accent-color);
      color:#fff;
      border-color:var(--accent-color);
    }
    .graph-control-btn:disabled { opacity:0.5; cursor:not-allowed; }
    #graph-export { margin:16px auto; display:flex; justify-content:center; gap:8px; flex-wrap:wrap; }
    #searchAutocomplete {
      display:none;
      position:absolute;
      top:100%;
      left:0;
      right:0;
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius-sm);
      max-height:240px;
      overflow-y:auto;
      z-index:100;
      box-shadow:var(--card-shadow-hover);
      margin-top:4px;
    }
    .autocomplete-item {
      padding:12px 16px;
      cursor:pointer;
      border-bottom:1px solid var(--hr-color);
      display:flex;
      align-items:center;
      gap:10px;
      transition:all 0.15s;
    }
    .autocomplete-item:hover { background:rgba(99,102,241,0.1); }
    .autocomplete-item:last-child { border-bottom:none; }
    .autocomplete-item .node-type { font-size:10px; padding:3px 8px; border-radius:10px; color:#fff; font-weight:600; }
    #osintNetwork {
      width:100%;
      max-width:1100px;
      height:700px;
      margin:0 auto;
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius);
      background:linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-color) 100%);
    }
    #osintNetwork.fullscreen {
      position:fixed !important;
      top:0;left:0;right:0;bottom:0;
      width:100vw !important;
      height:100vh !important;
      max-width:none !important;
      z-index:2000;
      border:none;
      border-radius:0;
    }
    body.fullscreen-graph { overflow:hidden; }
    #exitFullscreenBtn {
      position:fixed;
      top:20px;
      right:24px;
      z-index:2100;
      padding:12px 20px;
      background:var(--bg-secondary);
      color:var(--text-color);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius-sm);
      cursor:pointer;
      font-weight:600;
      box-shadow:var(--card-shadow);
      display:none;
    }
    #graphContextMenu {
      display:none;
      position:fixed;
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius-sm);
      box-shadow:var(--card-shadow-hover);
      z-index:3000;
      min-width:200px;
      overflow:hidden;
    }
    .ctx-item {
      padding:12px 16px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:12px;
      font-size:14px;
      transition:all 0.15s;
    }
    .ctx-item:hover { background:rgba(99,102,241,0.1); }
    .ctx-item i { width:18px; color:var(--text-secondary); }
    .ctx-divider { height:1px; background:var(--hr-color); margin:4px 0; }
    #nodeInfoPanel {
      width:300px;
      min-width:300px;
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius);
      padding:20px;
      background:var(--bg-secondary);
      display:none;
      flex-direction:column;
      gap:12px;
      max-height:700px;
      overflow-y:auto;
    }
    #nodeInfoPanel h4 {
      margin:0 0 12px;
      padding-bottom:12px;
      border-bottom:2px solid var(--accent-color);
      display:flex;
      align-items:center;
      gap:10px;
      font-size:16px;
    }
    #nodeInfoPanel button {
      width:100%;
      padding:10px;
      margin-bottom:6px;
      border-radius:var(--border-radius-sm);
      border:1px solid var(--hr-color);
      background:var(--bg-color);
      color:var(--text-color);
      cursor:pointer;
      font-weight:500;
      transition:all 0.2s;
    }
    #nodeInfoPanel button:hover { background:var(--accent-color); color:#fff; border-color:var(--accent-color); }

    .charts-container {
      display:flex;
      gap:32px;
      margin:32px 0;
      flex-wrap:wrap;
      justify-content:center;
    }
    .chart-card {
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius);
      padding:24px;
      box-shadow:var(--card-shadow);
      flex:1;
      min-width:350px;
      max-width:500px;
    }
    .chart-card-title {
      font-size:16px;
      font-weight:600;
      margin-bottom:16px;
      text-align:center;
      color:var(--text-color);
    }

    .report-footer {
      text-align:center;
      padding:32px;
      margin-top:48px;
      background:var(--bg-secondary);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius);
    }
    .report-footer h3 { margin:0 0 16px; font-size:18px; }
    .report-footer h3::before, .report-footer h3::after { display:none; }
    .footer-links { display:flex; justify-content:center; gap:24px; flex-wrap:wrap; margin-top:16px; }
    .footer-link {
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 20px;
      background:var(--bg-color);
      border:1px solid var(--hr-color);
      border-radius:var(--border-radius-sm);
      font-size:14px;
      font-weight:500;
      transition:all 0.2s;
    }
    .footer-link:hover { background:var(--accent-color); color:#fff; border-color:var(--accent-color); text-decoration:none; }
  </style>
</head>
<body id="top">

<div class="control-panel">
  <button class="control-btn" onclick="toggleTheme()" aria-label="Toggle theme"><i class="fas fa-moon"></i> Theme</button>
  <button class="control-btn" id="printBtn" aria-label="Print report"><i class="fas fa-print"></i> Print</button>
  <select id="fontSelect" onchange="changeFont(this.value)" class="font-select" aria-label="Font select">
    <option value="inter">Inter</option>
    <option value="plex">IBM Plex</option>
    <option value="fira">Fira Sans</option>
    <option value="grotesk">Space Grotesk</option>
  </select>
</div>

<div class="progress-bar"></div>

<div class="toc-container">
  <button class="toc-toggle" onclick="toggleToc()" aria-label="Toggle TOC"><i class="fas fa-bars"></i></button>
  <div class="toc-header">üìã Contents</div>
  
  <div class="toc-section-title">Overview</div>
  <a href="#general-scan-info" class="toc-link"><i class="fas fa-info-circle" style="color:#3b82f6;"></i> General Information</a>
  <a href="#general-scan-statistics" class="toc-link"><i class="fas fa-chart-bar" style="color:#10b981;"></i> Scan Statistics</a>
  <a href="#domain-infrastructure-visualisation" class="toc-link"><i class="fas fa-project-diagram" style="color:#f59e0b;"></i> Infrastructure Graph</a>
  
  <div class="toc-section-title">Domain Info</div>
  <a href="#whois-info" class="toc-link"><i class="fas fa-id-card" style="color:#6366f1;"></i> WHOIS Information</a>
  <a href="#dns-ssl-info" class="toc-link"><i class="fas fa-shield-alt" style="color:#8b5cf6;"></i> DNS & SSL Info</a>
  
  <div class="toc-section-title">Social & Subdomains</div>
  <a href="#social-media-links" class="toc-link"><i class="fas fa-share-alt" style="color:#ec4899;"></i> Social Media Links</a>
  <a href="#social-table-info" class="toc-link"><i class="fas fa-table" style="color:#ec4899;"></i> Social Media Analysis</a>
  <a href="#subdomains-info" class="toc-link"><i class="fas fa-sitemap" style="color:#14b8a6;"></i> Subdomains</a>
  <a href="#ip-addresses-info" class="toc-link"><i class="fas fa-network-wired" style="color:#06b6d4;"></i> IP Addresses Analysis</a>
  
  <div class="toc-section-title">Technology</div>
  <a href="#services-frameworks-info" class="toc-link"><i class="fas fa-cogs" style="color:#f97316;"></i> Services & Frameworks</a>
  <a href="#tech-table-info" class="toc-link"><i class="fas fa-microchip" style="color:#84cc16;"></i> Technology Analysis</a>
  
  <div class="toc-section-title">Security</div>
  <a href="#pre-pentest-info" class="toc-link"><i class="fas fa-bug" style="color:#ef4444;"></i> Pre-Pentest Info</a>
  <a href="#ports-table-info" class="toc-link"><i class="fas fa-door-open" style="color:#f59e0b;"></i> Ports Analysis</a>
  <a href="#vulns-table-info" class="toc-link"><i class="fas fa-exclamation-triangle" style="color:#dc2626;"></i> Vulnerabilities Analysis</a>
  
  <div class="toc-section-title">Files & Results</div>
  <a href="#technical-files" class="toc-link"><i class="fas fa-file-code" style="color:#78716c;"></i> Technical Files</a>
  <a href="#dorking-info" class="toc-link"><i class="fas fa-search" style="color:#0d9488;"></i> Dorking Results</a>
  <a href="#pagesearch-results" class="toc-link"><i class="fas fa-file-alt" style="color:#6366f1;"></i> PageSearch Results</a>
  
  <div class="toc-section-title">API Results</div>
  <a href="#virustotal-results" class="toc-link"><i class="fas fa-virus" style="color:#dc2626;"></i> VirusTotal</a>
  <a href="#securitytrails-results" class="toc-link"><i class="fas fa-route" style="color:#0891b2;"></i> SecurityTrails</a>
  <a href="#hudsonrock-results" class="toc-link"><i class="fas fa-user-secret" style="color:#7c3aed;"></i> HudsonRock</a>
</div>

<h1>üîç OSINT Research Report</h1>
<h2>{{ org }}</h2>
<hr>

<section id="general-scan-info">
  <h3><i class="fas fa-info-circle"></i> General Scan Information</h3>
  <div class="info-cards-grid">
    <div class="info-card">
      <div class="info-card-header">
        <div class="info-card-icon" style="background:linear-gradient(135deg, #6366f1, #8b5cf6);"><i class="fas fa-robot"></i></div>
        <div>
          <div class="info-card-title">Robots.txt</div>
          <div class="info-card-value">{{ robots_txt_result }}</div>
        </div>
      </div>
    </div>
    <div class="info-card">
      <div class="info-card-header">
        <div class="info-card-icon" style="background:linear-gradient(135deg, #10b981, #34d399);"><i class="fas fa-sitemap"></i></div>
        <div>
          <div class="info-card-title">Sitemap.xml</div>
          <div class="info-card-value">{{ sitemap_xml_result }}</div>
        </div>
      </div>
    </div>
    <div class="info-card">
      <div class="info-card-header">
        <div class="info-card-icon" style="background:linear-gradient(135deg, #3b82f6, #60a5fa);"><i class="fas fa-link"></i></div>
        <div>
          <div class="info-card-title">Sitemap Links</div>
          <div class="info-card-value">{{ sitemap_links }}</div>
        </div>
      </div>
    </div>
    <div class="info-card">
      <div class="info-card-header">
        <div class="info-card-icon" style="background:linear-gradient(135deg, #f59e0b, #fbbf24);"><i class="fas fa-search"></i></div>
        <div>
          <div class="info-card-title">Google Dorking</div>
          <div class="info-card-value">{{ dorking_status }}</div>
        </div>
      </div>
    </div>
    <div class="info-card">
      <div class="info-card-header">
        <div class="info-card-icon" style="background:linear-gradient(135deg, #ec4899, #f472b6);"><i class="fas fa-microscope"></i></div>
        <div>
          <div class="info-card-title">PageSearch</div>
          <div class="info-card-value">{{ pagesearch_ui_mark }}</div>
        </div>
      </div>
    </div>
    <div class="info-card">
      <div class="info-card-header">
        <div class="info-card-icon" style="background:linear-gradient(135deg, #14b8a6, #2dd4bf);"><i class="fas fa-camera"></i></div>
        <div>
          <div class="info-card-title">Snapshotting</div>
          <div class="info-card-value">{{ snapshotting_ui_mark }}</div>
        </div>
      </div>
    </div>
  </div>
  <div class="info-card" style="max-width:400px;margin:0 auto;">
    <div class="info-row">
      <span class="info-label"><i class="fas fa-clock"></i> Report Created</span>
      <span class="info-value">{{ ctime }}</span>
    </div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="general-scan-statistics">
  <h3><i class="fas fa-chart-bar"></i> Scan Statistics</h3>
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-card-icon">üåê</div>
      <div class="stat-card-value" id="a_tsf">{{ a_tsf }}</div>
      <div class="stat-card-label">Subdomains Found</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon">üì±</div>
      <div class="stat-card-value" id="a_tsm">{{ a_tsm }}</div>
      <div class="stat-card-label">Social Media Links</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon">‚úâÔ∏è</div>
      <div class="stat-card-value" id="a_temails">{{ a_temails }}</div>
      <div class="stat-card-label">Emails Found</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon">üî¢</div>
      <div class="stat-card-value" id="a_tips">{{ a_tips }}</div>
      <div class="stat-card-label">IP Addresses</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon">üö™</div>
      <div class="stat-card-value" id="a_tops">{{ a_tops }}</div>
      <div class="stat-card-label">Open Ports</div>
    </div>
    <div class="stat-card">
      <div class="stat-card-icon">‚ö†Ô∏è</div>
      <div class="stat-card-value" id="a_tpv">{{ a_tpv }}</div>
      <div class="stat-card-label">Vulnerabilities</div>
    </div>
  </div>
  
  <div class="section-card">
    <div class="section-card-header">
      <div class="section-card-icon" style="background:linear-gradient(135deg, #8b5cf6, #a78bfa);"><i class="fas fa-search-plus"></i></div>
      <div>
        <div class="section-card-title">PageSearch Statistics</div>
        <div class="section-card-subtitle">Detailed findings from page analysis</div>
      </div>
    </div>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-card-icon">üåê</div>
        <div class="stat-card-value" id="ps_s">{{ ps_s }}</div>
        <div class="stat-card-label">Accessible Subdomains</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-icon">üìß</div>
        <div class="stat-card-value" id="ps_e">{{ ps_e }}</div>
        <div class="stat-card-label">Email Addresses</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-icon">üìÑ</div>
        <div class="stat-card-value" id="ps_f">{{ ps_f }}</div>
        <div class="stat-card-label">Documents</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-icon">üç™</div>
        <div class="stat-card-value" id="ps_c">{{ ps_c }}</div>
        <div class="stat-card-label">Cookies</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-icon">üîë</div>
        <div class="stat-card-value" id="ps_a">{{ ps_a }}</div>
        <div class="stat-card-label">API Keys</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-icon">üß©</div>
        <div class="stat-card-value" id="ps_w">{{ ps_w }}</div>
        <div class="stat-card-label">Web Elements</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-icon">üîì</div>
        <div class="stat-card-value" id="ps_p">{{ ps_p }}</div>
        <div class="stat-card-label">Exposed Passwords</div>
      </div>
    </div>
  </div>
  
  <div class="charts-container">
    <div class="chart-card">
      <div class="chart-card-title">üìä Overall Statistics</div>
      <canvas id="statsChart" height="300"></canvas>
    </div>
    <div class="chart-card">
      <div class="chart-card-title">üì± Social Media Distribution</div>
      <canvas id="socialPie" height="300"></canvas>
		<div id="socialCounts"
			 data-fb="{% if fb_links and fb_links|length == 1 and 'links were not found' in fb_links[0] %}0{% else %}{{ fb_links|length }}{% endif %}"
			 data-tw="
			   {# Twitter #}
			   {% set tw_count = 0 %}
			   {% if tw_links %}
				 {% if not (tw_links|length == 1 and 'links were not found' in tw_links[0]) %}
				   {% set tw_count = tw_links|length %}
				 {% endif %}
			   {% endif %}
			   {# X.com #}
			   {% set x_count = 0 %}
			   {% if xcom_links %}
				 {% if not (xcom_links|length == 1 and 'links were not found' in xcom_links[0]) %}
				   {% set x_count = xcom_links|length %}
				 {% endif %}
			   {% endif %}
			   {{ tw_count + x_count }}
			 "
			 data-inst="{% if inst_links and inst_links|length == 1 and 'links were not found' in inst_links[0] %}0{% else %}{{ inst_links|length }}{% endif %}"
			 data-tg="{% if tg_links and tg_links|length == 1 and 'links were not found' in tg_links[0] %}0{% else %}{{ tg_links|length }}{% endif %}"
			 data-tt="{% if tt_links and tt_links|length == 1 and 'links were not found' in tt_links[0] %}0{% else %}{{ tt_links|length }}{% endif %}"
			 data-li="{% if li_links and li_links|length == 1 and 'links were not found' in li_links[0] %}0{% else %}{{ li_links|length }}{% endif %}"
			 data-vk="{% if vk_links and vk_links|length == 1 and 'links were not found' in vk_links[0] %}0{% else %}{{ vk_links|length }}{% endif %}"
			 data-yt="{% if yt_links and yt_links|length == 1 and 'links were not found' in yt_links[0] %}0{% else %}{{ yt_links|length }}{% endif %}"
			 data-ok="{% if ok_links and ok_links|length == 1 and 'links were not found' in ok_links[0] %}0{% else %}{{ ok_links|length }}{% endif %}"
			 data-wc="{% if wc_links and wc_links|length == 1 and 'links were not found' in wc_links[0] %}0{% else %}{{ wc_links|length }}{% endif %}"
			 style="display:none;">
		</div>
    </div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="domain-infrastructure-visualisation">
  <h3><i class="fas fa-project-diagram"></i> Domain Infrastructure Visualisation</h3>
  
  <div id="graph-stats">
    <div class="graph-stat-item"><i class="fas fa-circle" style="color:#6366f1"></i> Nodes: <strong id="stat-nodes">0</strong></div>
    <div class="graph-stat-item"><i class="fas fa-link" style="color:#8b5cf6"></i> Edges: <strong id="stat-edges">0</strong></div>
    <div class="graph-stat-item"><i class="fas fa-layer-group" style="color:#14b8a6"></i> Depth: <strong id="stat-depth">0</strong></div>
    <div class="graph-stat-item"><i class="fas fa-mouse-pointer" style="color:#ec4899"></i> Selected: <strong id="stat-selected">0</strong></div>
    <div class="graph-stat-item"><i class="fas fa-expand-arrows-alt" style="color:#f59e0b"></i> Expanded: <strong id="stat-expanded">0</strong></div>
  </div>
  
  <div id="graph-legend">
    <span class="legend-item"><span class="legend-dot" style="background:#6366f1"></span>Domain</span>
    <span class="legend-item"><span class="legend-dot" style="background:#64748b"></span>Services</span>
    <span class="legend-item"><span class="legend-dot" style="background:#3b82f6"></span>Subdomains</span>
    <span class="legend-item"><span class="legend-dot" style="background:#ec4899"></span>Socials</span>
    <span class="legend-item"><span class="legend-dot" style="background:#14b8a6"></span>IPs</span>
    <span class="legend-item"><span class="legend-dot" style="background:#f59e0b"></span>Ports</span>
    <span class="legend-item"><span class="legend-dot" style="background:#ef4444"></span>Vulnerabilities</span>
  </div>
  
  <div id="graph-filters">
    <label class="filter-checkbox"><input type="checkbox" data-filter="services" checked><span>‚öôÔ∏è Services</span></label>
    <label class="filter-checkbox"><input type="checkbox" data-filter="subdomains" checked><span>üåê Subdomains</span></label>
    <label class="filter-checkbox"><input type="checkbox" data-filter="social" checked><span>üì± Socials</span></label>
    <label class="filter-checkbox"><input type="checkbox" data-filter="ip" checked><span>üî¢ IPs</span></label>
    <label class="filter-checkbox"><input type="checkbox" data-filter="ports" checked><span>üö™ Ports</span></label>
    <label class="filter-checkbox"><input type="checkbox" data-filter="vulns" checked><span>‚ö†Ô∏è Vulns</span></label>
  </div>
  
  <div id="graph-search">
    <input type="text" id="graphSearchInput" placeholder="üîç Search nodes..." autocomplete="off">
    <div id="searchAutocomplete"></div>
    <button id="graphSearchBtn"><i class="fas fa-search"></i></button>
    <button id="graphPrevBtn"><i class="fas fa-chevron-left"></i></button>
    <button id="graphNextBtn"><i class="fas fa-chevron-right"></i></button>
    <button id="graphClearBtn"><i class="fas fa-times"></i></button>
    <span id="searchCounter" style="font-size:13px;color:var(--text-secondary);padding:10px;">0/0</span>
  </div>
  
  <div id="graph-export">
    <button id="exportPngBtn"><i class="fas fa-image"></i> PNG</button>
    <button id="exportSvgBtn"><i class="fas fa-vector-square"></i> SVG</button>
    <button id="exportJsonBtn"><i class="fas fa-file-code"></i> JSON</button>
    <button id="fullscreenGraphBtn"><i class="fas fa-expand"></i> Fullscreen</button>
  </div>
  
  <div style="display:flex;justify-content:center;gap:8px;margin:16px auto;flex-wrap:wrap;max-width:900px;">
    <button id="resetGraphBtn" class="graph-control-btn"><i class="fas fa-redo"></i> Reset</button>
    <button id="expandAllBtn" class="graph-control-btn"><i class="fas fa-folder-open"></i> Expand All</button>
    <button id="collapseBtn" class="graph-control-btn" disabled><i class="fas fa-folder"></i> Collapse</button>
    <button id="clusterBtn" class="graph-control-btn"><i class="fas fa-object-group"></i> Cluster</button>
    <button id="unclusterBtn" class="graph-control-btn"><i class="fas fa-object-ungroup"></i> Uncluster</button>
    <button id="fitGraphBtn" class="graph-control-btn"><i class="fas fa-compress-arrows-alt"></i> Fit View</button>
    <button id="physicsToggleBtn" class="graph-control-btn"><i class="fas fa-atom"></i> Physics: ON</button>
  </div>
  
  <div style="display:flex;gap:16px;max-width:1400px;margin:0 auto;">
    <div id="nodeInfoPanel">
      <h4><i class="fas fa-info-circle"></i> Node Details</h4>
      <div id="nodeInfoContent"><p class="empty-state" style="padding:20px;">Click on a node to see details</p></div>
      <div id="nodeActions" style="display:none;border-top:1px solid var(--hr-color);padding-top:12px;margin-top:12px;">
        <button id="copyNodeBtn"><i class="fas fa-copy"></i> Copy Label</button>
        <button id="openNodeLinkBtn"><i class="fas fa-external-link-alt"></i> Open Link</button>
        <button id="highlightConnectedBtn"><i class="fas fa-highlighter"></i> Highlight Connected</button>
      </div>
    </div>
    <div id="osintNetwork" tabindex="0" aria-label="Domain infrastructure graph"></div>
  </div>
  
  <button id="exitFullscreenBtn"><i class="fas fa-times"></i> Exit Fullscreen</button>
  
  <div id="graphContextMenu">
    <div class="ctx-item" data-action="copy"><i class="fas fa-copy"></i> Copy Label</div>
    <div class="ctx-item" data-action="copyAll"><i class="fas fa-clipboard-list"></i> Copy All Data</div>
    <div class="ctx-item" data-action="open"><i class="fas fa-external-link-alt"></i> Open Link</div>
    <div class="ctx-divider"></div>
    <div class="ctx-item" data-action="expand"><i class="fas fa-expand"></i> Expand Node</div>
    <div class="ctx-item" data-action="collapse"><i class="fas fa-compress"></i> Collapse Node</div>
    <div class="ctx-item" data-action="highlight"><i class="fas fa-highlighter"></i> Highlight Connected</div>
    <div class="ctx-divider"></div>
    <div class="ctx-item" data-action="focus"><i class="fas fa-crosshairs"></i> Focus on Node</div>
    <div class="ctx-item" data-action="hide"><i class="fas fa-eye-slash"></i> Hide Node</div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="whois-info">
  <h3><i class="fas fa-id-card"></i> WHOIS Information</h3>
  <div class="section-card">
    <div class="section-card-header">
      <div class="section-card-icon" style="background:linear-gradient(135deg, #6366f1, #8b5cf6);"><i class="fas fa-globe"></i></div>
      <div>
        <div class="section-card-title">Domain Registration Details</div>
        <div class="section-card-subtitle">Official registration information</div>
      </div>
    </div>
    <div class="info-cards-grid">
      <div class="info-card">
        <div class="info-row"><span class="info-label"><i class="fas fa-globe"></i> Domain</span><span class="info-value">{{ sh_domain }}</span></div>
        <div class="info-row"><span class="info-label"><i class="fas fa-link"></i> Full URL</span><span class="info-value"><a href="{{ full_url }}" target="_blank">{{ full_url }}</a></span></div>
        <div class="info-row"><span class="info-label"><i class="fas fa-network-wired"></i> IP Address</span><span class="info-value"><code class="code-cell">{{ ip_address }}</code></span></div>
        <div class="info-row"><span class="info-label"><i class="fas fa-building"></i> Registrar</span><span class="info-value">{{ registrar }}</span></div>
      </div>
      <div class="info-card">
        <div class="info-row"><span class="info-label"><i class="fas fa-calendar-plus"></i> Created</span><span class="info-value">{{ creation_date }}</span></div>
        <div class="info-row"><span class="info-label"><i class="fas fa-calendar-times"></i> Expires</span><span class="info-value">{{ expiration_date }}</span></div>
        <div class="info-row"><span class="info-label"><i class="fas fa-briefcase"></i> Organization</span><span class="info-value">{{ org }}</span></div>
        <div class="info-row"><span class="info-label"><i class="fas fa-envelope"></i> Contacts</span><span class="info-value">{{ mails }}</span></div>
      </div>
    </div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="dns-ssl-info">
  <h3><i class="fas fa-shield-alt"></i> DNS & SSL Information</h3>
  <div class="info-cards-grid">
    <div class="section-card">
      <div class="section-card-header">
        <div class="section-card-icon" style="background:linear-gradient(135deg, #3b82f6, #60a5fa);"><i class="fas fa-server"></i></div>
        <div>
          <div class="section-card-title">DNS Records</div>
          <div class="section-card-subtitle">Domain Name System configuration</div>
        </div>
      </div>
      <div class="info-row"><span class="info-label"><i class="fas fa-server"></i> Name Servers</span><span class="info-value">{{ name_servers }}</span></div>
      <div class="info-row"><span class="info-label"><i class="fas fa-envelope-open-text"></i> MX Records</span><span class="info-value">{{ mx_records }}</span></div>
    </div>
    <div class="section-card">
      <div class="section-card-header">
        <div class="section-card-icon" style="background:linear-gradient(135deg, #10b981, #34d399);"><i class="fas fa-lock"></i></div>
        <div>
          <div class="section-card-title">SSL Certificate</div>
          <div class="section-card-subtitle">Security certificate details</div>
        </div>
      </div>
      <div class="info-row"><span class="info-label"><i class="fas fa-user-check"></i> Issuer</span><span class="info-value">{{ issuer }}</span></div>
      <div class="info-row"><span class="info-label"><i class="fas fa-user-lock"></i> Subject</span><span class="info-value">{{ subject }}</span></div>
      <div class="info-row"><span class="info-label"><i class="fas fa-calendar-plus"></i> Valid From</span><span class="info-value">{{ notBefore }}</span></div>
      <div class="info-row"><span class="info-label"><i class="fas fa-calendar-times"></i> Valid Until</span><span class="info-value">{{ notAfter }}</span></div>
      <div class="info-row"><span class="info-label"><i class="fas fa-certificate"></i> Common Name</span><span class="info-value">{{ commonName }}</span></div>
      <div class="info-row"><span class="info-label"><i class="fas fa-fingerprint"></i> Serial</span><span class="info-value"><code class="code-cell" style="font-size:11px;">{{ serialNumber }}</code></span></div>
    </div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="social-media-links">
  <h3><i class="fas fa-share-alt"></i> Social Media Links</h3>
  <div class="info-cards-grid">
    <div class="list-card">
      <div class="list-card-header"><i class="fab fa-facebook"></i> Facebook</div>
      <div class="list-card-body">
        {% if fb_links %}{% for link in fb_links %}<div class="list-card-item"><i class="fas fa-link"></i><a href="{{ link }}" target="_blank" class="table-link">{{ link }}</a></div>{% endfor %}{% else %}<div class="list-card-empty">No Facebook links found</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #1da1f2, #60a5fa);"><i class="fab fa-twitter"></i> Twitter / X</div>
      <div class="list-card-body">
        {% if tw_links or xcom_links %}{% for link in tw_links %}<div class="list-card-item"><i class="fas fa-link"></i><a href="{{ link }}" target="_blank" class="table-link">{{ link }}</a></div>{% endfor %}{% for link in xcom_links %}<div class="list-card-item"><i class="fas fa-link"></i><a href="{{ link }}" target="_blank" class="table-link">{{ link }}</a></div>{% endfor %}{% else %}<div class="list-card-empty">No Twitter/X links found</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #e1306c, #f472b6);"><i class="fab fa-instagram"></i> Instagram</div>
      <div class="list-card-body">
        {% if inst_links %}{% for link in inst_links %}<div class="list-card-item"><i class="fas fa-link"></i><a href="{{ link }}" target="_blank" class="table-link">{{ link }}</a></div>{% endfor %}{% else %}<div class="list-card-empty">No Instagram links found</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #0088cc, #38bdf8);"><i class="fab fa-telegram"></i> Telegram</div>
      <div class="list-card-body">
        {% if tg_links %}{% for link in tg_links %}<div class="list-card-item"><i class="fas fa-link"></i><a href="{{ link }}" target="_blank" class="table-link">{{ link }}</a></div>{% endfor %}{% else %}<div class="list-card-empty">No Telegram links found</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #000000, #374151);"><i class="fab fa-tiktok"></i> TikTok</div>
      <div class="list-card-body">
        {% if tt_links %}{% for link in tt_links %}<div class="list-card-item"><i class="fas fa-link"></i><a href="{{ link }}" target="_blank" class="table-link">{{ link }}</a></div>{% endfor %}{% else %}<div class="list-card-empty">No TikTok links found</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #0077b5, #0ea5e9);"><i class="fab fa-linkedin"></i> LinkedIn</div>
      <div class="list-card-body">
        {% if li_links %}{% for link in li_links %}<div class="list-card-item"><i class="fas fa-link"></i><a href="{{ link }}" target="_blank" class="table-link">{{ link }}</a></div>{% endfor %}{% else %}<div class="list-card-empty">No LinkedIn links found</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #4a76a8, #6b8cae);"><i class="fab fa-vk"></i> VKontakte</div>
      <div class="list-card-body">
        {% if vk_links %}{% for link in vk_links %}<div class="list-card-item"><i class="fas fa-link"></i><a href="{{ link }}" target="_blank" class="table-link">{{ link }}</a></div>{% endfor %}{% else %}<div class="list-card-empty">No VK links found</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #ff0000, #f87171);"><i class="fab fa-youtube"></i> YouTube</div>
      <div class="list-card-body">
        {% if yt_links %}{% for link in yt_links %}<div class="list-card-item"><i class="fas fa-link"></i><a href="{{ link }}" target="_blank" class="table-link">{{ link }}</a></div>{% endfor %}{% else %}<div class="list-card-empty">No YouTube links found</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #ff8000, #fb923c);"><i class="fab fa-odnoklassniki"></i> Odnoklassniki</div>
      <div class="list-card-body">
        {% if ok_links %}{% for link in ok_links %}<div class="list-card-item"><i class="fas fa-link"></i><a href="{{ link }}" target="_blank" class="table-link">{{ link }}</a></div>{% endfor %}{% else %}<div class="list-card-empty">No OK links found</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #7bb32e, #84cc16);"><i class="fab fa-weixin"></i> WeChat</div>
      <div class="list-card-body">
        {% if wc_links %}{% for link in wc_links %}<div class="list-card-item"><i class="fas fa-link"></i><a href="{{ link }}" target="_blank" class="table-link">{{ link }}</a></div>{% endfor %}{% else %}<div class="list-card-empty">No WeChat links found</div>{% endif %}
      </div>
    </div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="social-table-info">
  <h3><i class="fas fa-table"></i> Social Media Analysis</h3>
  <div class="table-wrapper">
    <div class="table-toolbar toolbar-info">
      <button onclick="socialManager.selectAll()"><i class="fas fa-check-double"></i> Select All</button>
      <button onclick="socialManager.deselectAll()"><i class="fas fa-times"></i> Deselect</button>
      <button onclick="socialManager.verifySelected()"><i class="fas fa-check-circle"></i> Verify Links</button>
      <button onclick="socialManager.archiveSelected()"><i class="fas fa-archive"></i> Archive.org</button>
      <button onclick="socialManager.exportSelected()"><i class="fas fa-download"></i> Export</button>
      <select id="platformFilter" onchange="socialManager.filterByPlatform(this.value)">
        <option value="">üîé Filter by Platform...</option>
        <option value="facebook">Facebook</option>
        <option value="twitter">Twitter/X</option>
        <option value="instagram">Instagram</option>
        <option value="linkedin">LinkedIn</option>
        <option value="telegram">Telegram</option>
        <option value="youtube">YouTube</option>
      </select>
      <span class="selected-count" id="socialSelectedCount">0 selected</span>
    </div>
    <div id="socialTableContainer"></div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="subdomains-info">
  <h3><i class="fas fa-sitemap"></i> Subdomains Research</h3>
  <div class="table-wrapper">
    <div class="table-toolbar toolbar-primary">
      <button onclick="subdomainManager.selectAll()"><i class="fas fa-check-double"></i> Select All</button>
      <button onclick="subdomainManager.deselectAll()"><i class="fas fa-times"></i> Deselect</button>
      <button onclick="subdomainManager.checkSelected()"><i class="fas fa-search"></i> Check Selected</button>
      <button onclick="subdomainManager.exportSelected()"><i class="fas fa-download"></i> Export</button>
      <button onclick="subdomainManager.openAllSelected()"><i class="fas fa-external-link-alt"></i> Open All</button>
      <select id="bulkActionSelect" onchange="subdomainManager.performBulkAction(this.value)">
        <option value="">‚ö° Bulk Actions...</option>
        <option value="check-ssl">üîí Check SSL</option>
        <option value="check-headers">üìã Security Headers</option>
        <option value="dns-lookup">üîé DNS Lookup</option>
        <option value="whois">üìÑ WHOIS Info</option>
      </select>
      <span class="selected-count" id="selectedCount">0 selected</span>
    </div>
    <div id="subdomainsTableContainer"></div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="ip-addresses-info">
  <h3><i class="fas fa-network-wired"></i> IP Addresses Analysis</h3>
  <div class="table-wrapper">
    <div class="table-toolbar toolbar-success">
      <button onclick="ipManager.selectAll()"><i class="fas fa-check-double"></i> Select All</button>
      <button onclick="ipManager.deselectAll()"><i class="fas fa-times"></i> Deselect</button>
      <button onclick="ipManager.geolocateSelected()"><i class="fas fa-globe"></i> Geolocate</button>
      <button onclick="ipManager.exportSelected()"><i class="fas fa-download"></i> Export</button>
      <select id="ipBulkAction" onchange="ipManager.performBulkAction(this.value)">
        <option value="">‚ö° Bulk Actions...</option>
        <option value="shodan">üî¨ Shodan Lookup</option>
        <option value="virustotal">ü¶† VirusTotal</option>
        <option value="abuseipdb">üö® AbuseIPDB</option>
        <option value="reversedns">üîÑ Reverse DNS</option>
        <option value="whois">üìÑ WHOIS</option>
      </select>
      <span class="selected-count" id="ipSelectedCount">0 selected</span>
    </div>
    <div id="ipTableContainer"></div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="services-frameworks-info">
  <h3><i class="fas fa-cogs"></i> Services & Frameworks</h3>
  <div class="info-cards-grid">
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #3b82f6, #60a5fa);"><i class="fas fa-server"></i> Web Servers</div>
      <div class="list-card-body">
        {% if web_servers %}{% for ws in web_servers %}<div class="list-card-item"><i class="fas fa-check"></i><code class="code-cell">{{ ws }}</code></div>{% endfor %}{% else %}<div class="list-card-empty">No web servers detected</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #f59e0b, #fbbf24);"><i class="fas fa-tools"></i> CMS</div>
      <div class="list-card-body">
        {% if cms %}{% for cm in cms %}<div class="list-card-item"><i class="fas fa-check"></i><code class="code-cell">{{ cm }}</code></div>{% endfor %}{% else %}<div class="list-card-empty">No CMS detected</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #10b981, #34d399);"><i class="fas fa-code"></i> Programming Languages</div>
      <div class="list-card-body">
        {% if programming_languages %}{% for pl in programming_languages %}<div class="list-card-item"><i class="fas fa-check"></i><code class="code-cell">{{ pl }}</code></div>{% endfor %}{% else %}<div class="list-card-empty">No languages detected</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #8b5cf6, #a78bfa);"><i class="fas fa-layer-group"></i> Web Frameworks</div>
      <div class="list-card-body">
        {% if web_frameworks %}{% for wf in web_frameworks %}<div class="list-card-item"><i class="fas fa-check"></i><code class="code-cell">{{ wf }}</code></div>{% endfor %}{% else %}<div class="list-card-empty">No frameworks detected</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #06b6d4, #22d3ee);"><i class="fas fa-chart-line"></i> Analytics</div>
      <div class="list-card-body">
        {% if analytics %}{% for analytic in analytics %}<div class="list-card-item"><i class="fas fa-check"></i><code class="code-cell">{{ analytic }}</code></div>{% endfor %}{% else %}<div class="list-card-empty">No analytics detected</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #eab308, #facc15);"><i class="fab fa-js-square"></i> JavaScript Frameworks</div>
      <div class="list-card-body">
        {% if javascript_frameworks %}{% for jsf in javascript_frameworks %}<div class="list-card-item"><i class="fas fa-check"></i><code class="code-cell">{{ jsf }}</code></div>{% endfor %}{% else %}<div class="list-card-empty">No JS frameworks detected</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #64748b, #94a3b8);"><i class="fas fa-tags"></i> Tags</div>
      <div class="list-card-body">
        {% if tags %}{% for tag in tags %}<div class="list-card-item"><i class="fas fa-tag"></i><span class="tech-tag">{{ tag }}</span></div>{% endfor %}{% else %}<div class="list-card-empty">No tags found</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #78716c, #a8a29e);"><i class="fas fa-boxes"></i> CPE (Common Platform Enumeration)</div>
      <div class="list-card-body">
        {% if cpes %}{% for cpe in cpes %}<div class="list-card-item"><i class="fas fa-cube"></i><code class="code-cell" style="font-size:11px;">{{ cpe }}</code></div>{% endfor %}{% else %}<div class="list-card-empty">No CPE entries found</div>{% endif %}
      </div>
    </div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="tech-table-info">
  <h3><i class="fas fa-microchip"></i> Technology Stack Analysis</h3>
  <div class="table-wrapper">
    <div class="table-toolbar toolbar-purple">
      <button onclick="techManager.selectAll()"><i class="fas fa-check-double"></i> Select All</button>
      <button onclick="techManager.deselectAll()"><i class="fas fa-times"></i> Deselect</button>
      <button onclick="techManager.checkCVEs()"><i class="fas fa-bug"></i> Check CVEs</button>
      <button onclick="techManager.exportSelected()"><i class="fas fa-download"></i> Export</button>
      <select id="techFilter" onchange="techManager.filterByCategory(this.value)">
        <option value="">üîé Filter by Category...</option>
        <option value="webserver">Web Servers</option>
        <option value="cms">CMS</option>
        <option value="framework">Frameworks</option>
        <option value="language">Languages</option>
        <option value="analytics">Analytics</option>
        <option value="javascript">JavaScript</option>
      </select>
      <span class="selected-count" id="techSelectedCount">0 selected</span>
    </div>
    <div id="techTableContainer"></div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="pre-pentest-info">
  <h3><i class="fas fa-bug"></i> Pre-Pentest Information</h3>
  <div class="info-cards-grid">
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #f59e0b, #fbbf24);"><i class="fas fa-door-open"></i> Open Ports</div>
      <div class="list-card-body">
        {% if ports %}{% for op in ports %}<div class="list-card-item"><i class="fas fa-plug"></i><code class="code-cell">{{ op }}</code></div>{% endfor %}{% else %}<div class="list-card-empty">No open ports found</div>{% endif %}
      </div>
    </div>
    <div class="list-card">
      <div class="list-card-header" style="background:linear-gradient(135deg, #3b82f6, #60a5fa);"><i class="fas fa-globe"></i> Hostnames</div>
      <div class="list-card-body">
        {% if hostnames %}{% for hn in hostnames %}<div class="list-card-item"><i class="fas fa-server"></i><code class="code-cell">{{ hn }}</code></div>{% endfor %}{% else %}<div class="list-card-empty">No hostnames found</div>{% endif %}
      </div>
    </div>
    <div class="list-card" style="grid-column: span 2;">
      <div class="list-card-header" style="background:linear-gradient(135deg, #ef4444, #f87171);"><i class="fas fa-exclamation-triangle"></i> Potential Vulnerabilities</div>
      <div class="list-card-body">
        {% if vulns %}{% for vuln in vulns %}<div class="list-card-item"><i class="fas fa-bug"></i><span style="color:var(--danger-color);font-weight:500;">{{ vuln }}</span></div>{% endfor %}{% else %}<div class="list-card-empty" style="color:var(--success-color);">‚úÖ No vulnerabilities detected</div>{% endif %}
      </div>
    </div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="ports-table-info">
  <h3><i class="fas fa-door-open"></i> Ports Analysis</h3>
  <div class="table-wrapper">
    <div class="table-toolbar toolbar-warning">
      <button onclick="portsManager.selectAll()"><i class="fas fa-check-double"></i> Select All</button>
      <button onclick="portsManager.deselectAll()"><i class="fas fa-times"></i> Deselect</button>
      <button onclick="portsManager.exportSelected()"><i class="fas fa-download"></i> Export</button>
      <button onclick="portsManager.generateNmapCommand()"><i class="fas fa-terminal"></i> Generate Nmap</button>
      <select id="portFilter" onchange="portsManager.filterByService(this.value)">
        <option value="">üîé Filter by Service...</option>
        <option value="http">HTTP/HTTPS</option>
        <option value="ssh">SSH</option>
        <option value="ftp">FTP</option>
        <option value="database">Databases</option>
        <option value="mail">Mail</option>
        <option value="remote">Remote Access</option>
      </select>
      <span class="selected-count" id="portsSelectedCount">0 selected</span>
    </div>
    <div id="portsTableContainer"></div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="vulns-table-info">
  <h3><i class="fas fa-exclamation-triangle"></i> Vulnerabilities Analysis</h3>
  <div class="table-wrapper">
    <div class="table-toolbar toolbar-danger">
      <button onclick="vulnsManager.selectAll()"><i class="fas fa-check-double"></i> Select All</button>
      <button onclick="vulnsManager.deselectAll()"><i class="fas fa-times"></i> Deselect</button>
      <button onclick="vulnsManager.exportSelected()"><i class="fas fa-download"></i> Export Report</button>
      <button onclick="vulnsManager.generateRemediation()"><i class="fas fa-tools"></i> Remediation Guide</button>
      <select id="severityFilter" onchange="vulnsManager.filterBySeverity(this.value)">
        <option value="">‚ö†Ô∏è Filter by Severity...</option>
        <option value="critical">üî¥ Critical</option>
        <option value="high">üü† High</option>
        <option value="medium">üü° Medium</option>
        <option value="low">üü¢ Low</option>
      </select>
      <span class="selected-count" id="vulnsSelectedCount">0 selected</span>
    </div>
    <div id="vulnsTableContainer"></div>
  </div>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

<section id="technical-files">
  <h3><i class="fas fa-file-code"></i> Technical Files</h3>
  <details>
    <summary><i class="fas fa-robot" style="color:#8b5cf6;"></i> robots.txt</summary>
    <pre>{{ robots_content | safe }}</pre>
  </details>
  <details>
    <summary><i class="fas fa-sitemap" style="color:#10b981;"></i> sitemap.xml</summary>
    <pre>{{ sitemap_xml_content | safe }}</pre>
  </details>
  <details>
    <summary><i class="fas fa-link" style="color:#3b82f6;"></i> Sitemap Links</summary>
    <pre>{{ sitemap_txt_content | safe }}</pre>
  </details>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>

{% if add_dsi %}
<section id="dorking-info">
  <h3><i class="fas fa-search"></i> Dorking Scan Results</h3>
  <details>
    <summary><i class="fas fa-search" style="color:#14b8a6;"></i> Google Dorking Results</summary>
    <pre>{{ add_dsi | safe }}</pre>
  </details>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>
{% endif %}

{% if ps_string %}
<section id="pagesearch-results">
  <h3><i class="fas fa-file-alt"></i> PageSearch Results</h3>
  <details>
    <summary><i class="fas fa-file-alt" style="color:#6366f1;"></i> PageSearch Process Listing</summary>
    <pre>{{ ps_string }}</pre>
  </details>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>
{% endif %}

{% if virustotal_output %}
<section id="virustotal-results">
  <h3><i class="fas fa-virus"></i> VirusTotal API Results</h3>
  <details>
    <summary><i class="fas fa-virus" style="color:#dc2626;"></i> VirusTotal Scan Output</summary>
    <pre>{{ virustotal_output | safe }}</pre>
  </details>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>
{% endif %}

{% if securitytrails_output %}
<section id="securitytrails-results">
  <h3><i class="fas fa-route"></i> SecurityTrails API Results</h3>
  <details>
    <summary><i class="fas fa-route" style="color:#0891b2;"></i> SecurityTrails Output</summary>
    <pre>{{ securitytrails_output | safe }}</pre>
  </details>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>
{% endif %}

{% if hudsonrock_output %}
<section id="hudsonrock-results">
  <h3><i class="fas fa-user-secret"></i> HudsonRock API Results</h3>
  <details>
    <summary><i class="fas fa-user-secret" style="color:#7c3aed;"></i> HudsonRock Output</summary>
    <pre>{{ hudsonrock_output | safe }}</pre>
  </details>
</section>
<div class="back-to-top"><a href="#top"><i class="fas fa-arrow-up"></i> Back to top</a></div>
<hr>
{% endif %}

<div class="report-footer">
  <h3>üîç Created with DPULSE by OSINT-TECHNOLOGIES</h3>
  <p style="color:var(--text-secondary);margin-bottom:16px;">Professional Open Source Intelligence Research Tool</p>
  <div class="footer-links">
    <a href="https://github.com/OSINT-TECHNOLOGIES" target="_blank" class="footer-link"><i class="fab fa-github"></i> GitHub</a>
    <a href="https://pypi.org/project/dpulse/" target="_blank" class="footer-link"><i class="fab fa-python"></i> PyPI</a>
  </div>
</div>
<script>
  const fontMap = {
    inter: { main: "'Inter', system-ui, sans-serif", code: "'Roboto Mono', monospace" },
    plex: { main: "'IBM Plex Sans', sans-serif", code: "'IBM Plex Mono', monospace" },
    fira: { main: "'Fira Sans', sans-serif", code: "'Fira Code', monospace" },
    grotesk: { main: "'Space Grotesk', sans-serif", code: "'Roboto Mono', monospace" }
  };

  function changeFont(val) {
    const c = fontMap[val] || fontMap.inter;
    document.documentElement.style.setProperty('--font-main', c.main);
    document.documentElement.style.setProperty('--font-code', c.code);
    localStorage.setItem('fontChoice', val);
  }

  function toggleTheme() {
    document.body.classList.toggle('dark');
    localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
  }

  function toggleToc() {
    const toc = document.querySelector('.toc-container');
    toc.classList.toggle('collapsed');
    document.body.style.paddingLeft = toc.classList.contains('collapsed') ? '80px' : '280px';
    localStorage.setItem('tocCollapsed', toc.classList.contains('collapsed'));
  }

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => showToast('‚úÖ Copied to clipboard', 'success'));
  }

  function showToast(message, type = 'success') {
    const colors = { success: '#10b981', error: '#ef4444', warning: '#f59e0b', info: '#3b82f6' };
    const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
    const toast = document.createElement('div');
    toast.innerHTML = `${icons[type]} ${message}`;
    toast.style.cssText = `position:fixed;bottom:24px;right:24px;background:${colors[type]};color:#fff;padding:14px 24px;border-radius:12px;z-index:10000;box-shadow:0 10px 25px rgba(0,0,0,0.2);font-size:14px;font-weight:500;animation:slideUp 0.3s ease;`;
    document.body.appendChild(toast);
    setTimeout(() => { toast.style.opacity = '0'; toast.style.transform = 'translateY(20px)'; setTimeout(() => toast.remove(), 300); }, 3000);
  }

  function downloadFile(content, filename, type) {
    const blob = new Blob([content], { type });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
    URL.revokeObjectURL(a.href);
  }

  const subdomainManager = {
    table: null,
    subdomains: [{% for sub in subdomains %}'{{ sub }}',{% endfor %}],
    ips: [{% for ip in subdomain_ips %}'{{ ip }}',{% endfor %}],
    selected: new Set(),
    statusData: {},

    init() {
      if (this.subdomains.length === 0) {
        document.getElementById('subdomainsTableContainer').innerHTML = '<p class="empty-state">üîç No subdomains found during scan</p>';
        return;
      }
      this.createTable();
      this.startAutoCheck();
    },

    createTable() {
      const tableHtml = `
        <table id="subdomainsTable" class="dataTable-table">
          <thead><tr>
            <th style="width:50px;"><input type="checkbox" id="selectAllSubdomains" class="table-checkbox" onchange="subdomainManager.toggleSelectAll(this.checked)"></th>
            <th>#</th><th>Subdomain</th><th>IP Address</th><th>Status</th><th>SSL</th><th>Actions</th>
          </tr></thead>
          <tbody>${this.subdomains.map((sub, i) => this.createRow(sub, i)).join('')}</tbody>
        </table>`;
      document.getElementById('subdomainsTableContainer').innerHTML = tableHtml;
      if (window.simpleDatatables) {
        this.table = new simpleDatatables.DataTable('#subdomainsTable', {
          searchable: true, perPage: 25, perPageSelect: [10, 25, 50, 100],
          labels: { placeholder: "Search subdomains...", info: "Showing {start} to {end} of {rows} subdomains" }
        });
      }
    },

    createRow(sub, index) {
      const ip = this.ips[index] || 'N/A';
      return `<tr id="sub-row-${index}">
        <td><input type="checkbox" class="table-checkbox sub-checkbox" data-index="${index}" onchange="subdomainManager.toggleSelect(${index}, this.checked)"></td>
        <td><strong>${index + 1}</strong></td>
        <td><a href="https://${sub}" target="_blank" class="table-link">${sub}</a></td>
        <td><code class="code-cell">${ip}</code></td>
        <td id="sub-status-${index}"><span class="status-badge status-unknown">‚è≥ Pending</span></td>
        <td id="sub-ssl-${index}"><span class="status-badge status-unknown">‚è≥ Pending</span></td>
        <td><div class="table-actions">
          <button class="action-btn tooltip" onclick="window.open('https://${sub}','_blank')"><i class="fas fa-external-link-alt"></i><span class="tooltiptext">Open</span></button>
          <button class="action-btn tooltip" onclick="copyToClipboard('${sub}')"><i class="fas fa-copy"></i><span class="tooltiptext">Copy</span></button>
          <button class="action-btn tooltip" onclick="subdomainManager.checkStatus(${index})"><i class="fas fa-sync"></i><span class="tooltiptext">Check</span></button>
          <button class="action-btn tooltip" onclick="window.open('https://securityheaders.com/?q=${sub}','_blank')"><i class="fas fa-shield-alt"></i><span class="tooltiptext">Headers</span></button>
          <button class="action-btn tooltip" onclick="window.open('https://www.shodan.io/search?query=hostname:${sub}','_blank')"><i class="fas fa-search"></i><span class="tooltiptext">Shodan</span></button>
        </div></td>
      </tr>`;
    },

    toggleSelect(index, checked) {
      checked ? this.selected.add(index) : this.selected.delete(index);
      this.updateSelectedCount();
      document.getElementById(`sub-row-${index}`)?.classList.toggle('selected', checked);
    },

    toggleSelectAll(checked) {
      document.querySelectorAll('.sub-checkbox').forEach((cb, i) => { cb.checked = checked; this.toggleSelect(i, checked); });
    },

    selectAll() { document.getElementById('selectAllSubdomains').checked = true; this.toggleSelectAll(true); },
    deselectAll() { document.getElementById('selectAllSubdomains').checked = false; this.toggleSelectAll(false); },
    updateSelectedCount() { document.getElementById('selectedCount').textContent = `${this.selected.size} selected`; },

    async checkStatus(index) {
      const sub = this.subdomains[index];
      const statusEl = document.getElementById(`sub-status-${index}`);
      const sslEl = document.getElementById(`sub-ssl-${index}`);
      statusEl.innerHTML = '<span class="status-badge status-checking"><span class="loading-spinner"></span></span>';
      sslEl.innerHTML = '<span class="status-badge status-checking"><span class="loading-spinner"></span></span>';
      try {
        await fetch(`https://${sub}`, { mode: 'no-cors', cache: 'no-cache' });
        this.statusData[index] = { active: true };
        statusEl.innerHTML = '<span class="status-badge status-active">‚úÖ Active</span>';
        sslEl.innerHTML = '<span class="status-badge status-ssl-valid">üîí Valid</span>';
      } catch {
        this.statusData[index] = { active: false };
        statusEl.innerHTML = '<span class="status-badge status-inactive">‚ùå Inactive</span>';
        sslEl.innerHTML = '<span class="status-badge status-ssl-invalid">üîì No SSL</span>';
      }
    },

    startAutoCheck() {
      const limit = Math.min(5, this.subdomains.length);
      for (let i = 0; i < limit; i++) setTimeout(() => this.checkStatus(i), i * 600);
    },

    checkSelected() {
      if (this.selected.size === 0) { showToast('Please select at least one subdomain', 'warning'); return; }
      let i = 0;
      this.selected.forEach(index => { setTimeout(() => this.checkStatus(index), i * 400); i++; });
    },

    exportSelected() {
      if (this.selected.size === 0) { showToast('Please select at least one subdomain', 'warning'); return; }
      const data = []; this.selected.forEach(index => data.push({ subdomain: this.subdomains[index], ip: this.ips[index] || 'N/A', status: this.statusData[index]?.active ? 'Active' : 'Unknown' }));
      const csv = 'Subdomain,IP Address,Status\n' + data.map(d => `${d.subdomain},${d.ip},${d.status}`).join('\n');
      downloadFile(csv, `subdomains_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
      showToast(`Exported ${this.selected.size} subdomains`, 'success');
    },

    openAllSelected() {
      if (this.selected.size === 0) { showToast('Please select at least one subdomain', 'warning'); return; }
      if (this.selected.size > 10 && !confirm(`Open ${this.selected.size} tabs?`)) return;
      this.selected.forEach(index => window.open(`https://${this.subdomains[index]}`, '_blank'));
    },

    performBulkAction(action) {
      if (!action) return;
      if (this.selected.size === 0) { showToast('Please select at least one subdomain', 'warning'); document.getElementById('bulkActionSelect').value = ''; return; }
      this.selected.forEach(index => {
        const sub = this.subdomains[index];
        switch(action) {
          case 'check-ssl': this.checkStatus(index); break;
          case 'check-headers': window.open(`https://securityheaders.com/?q=${sub}`, '_blank'); break;
          case 'dns-lookup': window.open(`https://mxtoolbox.com/SuperTool.aspx?action=a%3a${sub}`, '_blank'); break;
          case 'whois': window.open(`https://www.whois.com/whois/${sub}`, '_blank'); break;
        }
      });
      document.getElementById('bulkActionSelect').value = '';
    }
  };

  const ipManager = {
    table: null,
    ips: [{% for ip in ip_addresses %}'{{ ip }}',{% endfor %}],
    selected: new Set(),
    geoData: {},

    init() {
      if (this.ips.length === 0) {
        document.getElementById('ipTableContainer').innerHTML = '<p class="empty-state">üîç No IP addresses found during scan</p>';
        return;
      }
      this.createTable();
    },

    createTable() {
      const tableHtml = `
        <table id="ipTable" class="dataTable-table">
          <thead><tr>
            <th style="width:50px;"><input type="checkbox" class="table-checkbox" onchange="ipManager.toggleSelectAll(this.checked)"></th>
            <th>#</th><th>IP Address</th><th>Type</th><th>Location</th><th>ISP / ASN</th><th>Actions</th>
          </tr></thead>
          <tbody>${this.ips.map((ip, i) => this.createRow(ip, i)).join('')}</tbody>
        </table>`;
      document.getElementById('ipTableContainer').innerHTML = tableHtml;
      if (window.simpleDatatables) {
        this.table = new simpleDatatables.DataTable('#ipTable', { searchable: true, perPage: 25, labels: { placeholder: "Search IPs..." } });
      }
    },

    createRow(ip, index) {
      const isIPv6 = ip.includes(':');
      const typeBadge = isIPv6 ? '<span class="status-badge" style="background:linear-gradient(135deg,#8b5cf6,#a78bfa);">IPv6</span>' : '<span class="status-badge" style="background:linear-gradient(135deg,#3b82f6,#60a5fa);">IPv4</span>';
      return `<tr id="ip-row-${index}">
        <td><input type="checkbox" class="table-checkbox ip-checkbox" data-index="${index}" onchange="ipManager.toggleSelect(${index}, this.checked)"></td>
        <td><strong>${index + 1}</strong></td>
        <td><code class="code-cell">${ip}</code></td>
        <td>${typeBadge}</td>
        <td id="ip-geo-${index}"><span class="status-badge status-unknown">‚è≥ Unknown</span></td>
        <td id="ip-asn-${index}">-</td>
        <td><div class="table-actions">
          <button class="action-btn tooltip" onclick="ipManager.geolocate(${index})"><i class="fas fa-globe"></i><span class="tooltiptext">Geolocate</span></button>
          <button class="action-btn tooltip" onclick="copyToClipboard('${ip}')"><i class="fas fa-copy"></i><span class="tooltiptext">Copy</span></button>
          <button class="action-btn tooltip" onclick="window.open('https://www.shodan.io/host/${ip}','_blank')"><i class="fas fa-search"></i><span class="tooltiptext">Shodan</span></button>
          <button class="action-btn tooltip" onclick="window.open('https://www.virustotal.com/gui/ip-address/${ip}','_blank')"><i class="fas fa-virus"></i><span class="tooltiptext">VirusTotal</span></button>
          <button class="action-btn tooltip" onclick="window.open('https://www.abuseipdb.com/check/${ip}','_blank')"><i class="fas fa-exclamation-triangle"></i><span class="tooltiptext">AbuseIPDB</span></button>
        </div></td>
      </tr>`;
    },

    toggleSelect(index, checked) { checked ? this.selected.add(index) : this.selected.delete(index); this.updateSelectedCount(); },
    toggleSelectAll(checked) { document.querySelectorAll('.ip-checkbox').forEach((cb, i) => { cb.checked = checked; this.toggleSelect(i, checked); }); },
    selectAll() { this.toggleSelectAll(true); },
    deselectAll() { this.toggleSelectAll(false); },
    updateSelectedCount() { document.getElementById('ipSelectedCount').textContent = `${this.selected.size} selected`; },

    async geolocate(index) {
      const ip = this.ips[index];
      const geoEl = document.getElementById(`ip-geo-${index}`);
      const asnEl = document.getElementById(`ip-asn-${index}`);
      geoEl.innerHTML = '<span class="status-badge status-checking"><span class="loading-spinner"></span></span>';
      try {
        const res = await fetch(`https://ipapi.co/${ip}/json/`);
        const data = await res.json();
        if (data.country_name) {
          geoEl.innerHTML = `<span title="${data.city}, ${data.country_name}">üåç ${data.country_code}</span>`;
          asnEl.innerHTML = `<span class="code-cell" style="font-size:11px;">${(data.org || 'N/A').substring(0, 30)}</span>`;
          this.geoData[index] = data;
        } else throw new Error();
      } catch { geoEl.innerHTML = '<span class="status-badge status-unknown" style="cursor:pointer;" onclick="window.open(\'https://ipinfo.io/' + ip + '\',\'_blank\')">üîó Lookup</span>'; }
    },

    geolocateSelected() {
      if (this.selected.size === 0) { showToast('Please select at least one IP', 'warning'); return; }
      let i = 0; this.selected.forEach(index => { setTimeout(() => this.geolocate(index), i * 700); i++; });
    },

    exportSelected() {
      if (this.selected.size === 0) { showToast('Please select at least one IP', 'warning'); return; }
      const data = []; this.selected.forEach(index => { const geo = this.geoData[index] || {}; data.push({ ip: this.ips[index], country: geo.country_name || 'Unknown', city: geo.city || 'Unknown', isp: geo.org || 'Unknown' }); });
      const csv = 'IP,Country,City,ISP\n' + data.map(d => `${d.ip},${d.country},${d.city},"${d.isp}"`).join('\n');
      downloadFile(csv, `ip_addresses_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
      showToast(`Exported ${this.selected.size} IPs`, 'success');
    },

    performBulkAction(action) {
      if (!action) return;
      if (this.selected.size === 0) { showToast('Please select at least one IP', 'warning'); document.getElementById('ipBulkAction').value = ''; return; }
      this.selected.forEach(index => {
        const ip = this.ips[index];
        switch(action) {
          case 'shodan': window.open(`https://www.shodan.io/host/${ip}`, '_blank'); break;
          case 'virustotal': window.open(`https://www.virustotal.com/gui/ip-address/${ip}`, '_blank'); break;
          case 'abuseipdb': window.open(`https://www.abuseipdb.com/check/${ip}`, '_blank'); break;
          case 'reversedns': window.open(`https://mxtoolbox.com/SuperTool.aspx?action=ptr%3a${ip}`, '_blank'); break;
          case 'whois': window.open(`https://whois.domaintools.com/${ip}`, '_blank'); break;
        }
      });
      document.getElementById('ipBulkAction').value = '';
    }
  };

  const portsManager = {
    table: null,
    ports: [{% for op in ports %}'{{ op }}',{% endfor %}],
    selected: new Set(),
    portInfo: {
      21:{s:'FTP',c:'ftp',r:'high'},22:{s:'SSH',c:'ssh',r:'medium'},23:{s:'Telnet',c:'remote',r:'critical'},
      25:{s:'SMTP',c:'mail',r:'medium'},53:{s:'DNS',c:'dns',r:'low'},80:{s:'HTTP',c:'http',r:'medium'},
      110:{s:'POP3',c:'mail',r:'medium'},143:{s:'IMAP',c:'mail',r:'medium'},443:{s:'HTTPS',c:'http',r:'low'},
      445:{s:'SMB',c:'file',r:'critical'},993:{s:'IMAPS',c:'mail',r:'low'},995:{s:'POP3S',c:'mail',r:'low'},
      1433:{s:'MSSQL',c:'database',r:'high'},1521:{s:'Oracle',c:'database',r:'high'},3306:{s:'MySQL',c:'database',r:'high'},
      3389:{s:'RDP',c:'remote',r:'critical'},5432:{s:'PostgreSQL',c:'database',r:'high'},5900:{s:'VNC',c:'remote',r:'critical'},
      6379:{s:'Redis',c:'database',r:'high'},8080:{s:'HTTP-Alt',c:'http',r:'medium'},8443:{s:'HTTPS-Alt',c:'http',r:'low'},
      27017:{s:'MongoDB',c:'database',r:'high'}
    },

    init() {
      if (this.ports.length === 0) {
        document.getElementById('portsTableContainer').innerHTML = '<p class="empty-state">‚úÖ No open ports detected</p>';
        return;
      }
      this.createTable();
    },

    parsePort(str) { const m = str.match(/(\d+)/); return m ? parseInt(m[1]) : null; },

    createTable() {
      const tableHtml = `
        <table id="portsTable" class="dataTable-table">
          <thead><tr>
            <th style="width:50px;"><input type="checkbox" class="table-checkbox" onchange="portsManager.toggleSelectAll(this.checked)"></th>
            <th>#</th><th>Port</th><th>Service</th><th>Category</th><th>Risk</th><th>Actions</th>
          </tr></thead>
          <tbody>${this.ports.map((p, i) => this.createRow(p, i)).join('')}</tbody>
        </table>`;
      document.getElementById('portsTableContainer').innerHTML = tableHtml;
      if (window.simpleDatatables) this.table = new simpleDatatables.DataTable('#portsTable', { searchable: true, perPage: 25, labels: { placeholder: "Search ports..." } });
    },

    createRow(portStr, index) {
      const num = this.parsePort(portStr);
      const info = this.portInfo[num] || { s: 'Unknown', c: 'other', r: 'unknown' };
      const riskBadges = { critical: 'risk-critical', high: 'risk-high', medium: 'risk-medium', low: 'risk-low', unknown: 'status-unknown' };
      const riskLabels = { critical: 'üî¥ CRITICAL', high: 'üü† HIGH', medium: 'üü° MEDIUM', low: 'üü¢ LOW', unknown: '‚ö™ UNKNOWN' };
      const icons = { http:'üåê', ftp:'üìÅ', ssh:'üîê', mail:'‚úâÔ∏è', database:'üóÉÔ∏è', remote:'üñ•Ô∏è', dns:'üì°', file:'üìÇ', other:'‚ùì' };
      const bgStyle = info.r === 'critical' ? 'background:rgba(239,68,68,0.1);' : '';
      return `<tr id="port-row-${index}" style="${bgStyle}">
        <td><input type="checkbox" class="table-checkbox port-checkbox" data-index="${index}" onchange="portsManager.toggleSelect(${index}, this.checked)"></td>
        <td><strong>${index + 1}</strong></td>
        <td><code class="code-cell" style="font-weight:700;">${portStr}</code></td>
        <td><span class="tech-tag">${info.s}</span></td>
        <td>${icons[info.c] || '‚ùì'} ${info.c}</td>
        <td><span class="status-badge ${riskBadges[info.r]}">${riskLabels[info.r]}</span></td>
        <td><div class="table-actions">
          <button class="action-btn tooltip" onclick="copyToClipboard('${portStr}')"><i class="fas fa-copy"></i><span class="tooltiptext">Copy</span></button>
          <button class="action-btn tooltip" onclick="window.open('https://www.speedguide.net/port.php?port=${num}','_blank')"><i class="fas fa-book"></i><span class="tooltiptext">Info</span></button>
          <button class="action-btn tooltip" onclick="window.open('https://www.exploit-db.com/search?port=${num}','_blank')"><i class="fas fa-skull"></i><span class="tooltiptext">Exploits</span></button>
          <button class="action-btn tooltip" onclick="portsManager.copyNmapCmd(${num})"><i class="fas fa-terminal"></i><span class="tooltiptext">Nmap</span></button>
        </div></td>
      </tr>`;
    },

    toggleSelect(index, checked) { checked ? this.selected.add(index) : this.selected.delete(index); this.updateSelectedCount(); },
    toggleSelectAll(checked) { document.querySelectorAll('.port-checkbox').forEach((cb, i) => { cb.checked = checked; this.toggleSelect(i, checked); }); },
    selectAll() { this.toggleSelectAll(true); },
    deselectAll() { this.toggleSelectAll(false); },
    updateSelectedCount() { document.getElementById('portsSelectedCount').textContent = `${this.selected.size} selected`; },
    copyNmapCmd(port) { copyToClipboard(`nmap -sV -sC -p ${port} {{ sh_domain }}`); },

    generateNmapCommand() {
      if (this.selected.size === 0) { showToast('Please select at least one port', 'warning'); return; }
      const ports = []; this.selected.forEach(i => { const p = this.parsePort(this.ports[i]); if (p) ports.push(p); });
      copyToClipboard(`nmap -sV -sC -p ${ports.join(',')} {{ sh_domain }}`);
      showToast('Nmap command copied', 'success');
    },

    filterByService(cat) { if (!cat) this.table?.search(''); else this.table?.search(cat); },

    exportSelected() {
      if (this.selected.size === 0) { showToast('Please select at least one port', 'warning'); return; }
      const data = []; this.selected.forEach(i => { const num = this.parsePort(this.ports[i]); const info = this.portInfo[num] || { s: 'Unknown', r: 'unknown' }; data.push({ port: this.ports[i], service: info.s, risk: info.r }); });
      const csv = 'Port,Service,Risk\n' + data.map(d => `${d.port},${d.service},${d.risk}`).join('\n');
      downloadFile(csv, `ports_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
      showToast(`Exported ${this.selected.size} ports`, 'success');
    }
  };

	const socialManager = {
	  table: null, links: [], selected: new Set(),

	  init() {
		  const platforms = [
			{ n: 'Facebook', i: 'fab fa-facebook', c: '#1877f2',
			  l: [{% for l in fb_links %}{% if 'links were not found' not in l %}'{{ l }}',{% endif %}{% endfor %}] },
			{ n: 'Twitter/X', i: 'fab fa-twitter', c: '#1da1f2',
			  l: [
				{% for l in tw_links %}{% if 'links were not found' not in l %}'{{ l }}',{% endif %}{% endfor %}
				{% for l in xcom_links %}{% if 'links were not found' not in l %}'{{ l }}',{% endif %}{% endfor %}
			  ] },
			{ n: 'Instagram', i: 'fab fa-instagram', c: '#e1306c',
			  l: [{% for l in inst_links %}{% if 'links were not found' not in l %}'{{ l }}',{% endif %}{% endfor %}] },
			{ n: 'Telegram', i: 'fab fa-telegram', c: '#0088cc',
			  l: [{% for l in tg_links %}{% if 'links were not found' not in l %}'{{ l }}',{% endif %}{% endfor %}] },
			{ n: 'TikTok', i: 'fab fa-tiktok', c: '#000',
			  l: [{% for l in tt_links %}{% if 'links were not found' not in l %}'{{ l }}',{% endif %}{% endfor %}] },
			{ n: 'LinkedIn', i: 'fab fa-linkedin', c: '#0077b5',
			  l: [{% for l in li_links %}{% if 'links were not found' not in l %}'{{ l }}',{% endif %}{% endfor %}] },
			{ n: 'VK', i: 'fab fa-vk', c: '#4a76a8',
			  l: [{% for l in vk_links %}{% if 'links were not found' not in l %}'{{ l }}',{% endif %}{% endfor %}] },
			{ n: 'YouTube', i: 'fab fa-youtube', c: '#ff0000',
			  l: [{% for l in yt_links %}{% if 'links were not found' not in l %}'{{ l }}',{% endif %}{% endfor %}] },
			{ n: 'OK', i: 'fab fa-odnoklassniki', c: '#ff8000',
			  l: [{% for l in ok_links %}{% if 'links were not found' not in l %}'{{ l }}',{% endif %}{% endfor %}] },
			{ n: 'WeChat', i: 'fab fa-weixin', c: '#7bb32e',
			  l: [{% for l in wc_links %}{% if 'links were not found' not in l %}'{{ l }}',{% endif %}{% endfor %}] }
		  ];
		  platforms.forEach(p =>
			p.l.forEach(url => {
			  if (url) this.links.push({ name: p.n, icon: p.i, color: p.c, url });
			})
		  );
		  if (this.links.length === 0) {
			document.getElementById('socialTableContainer').innerHTML =
			  '<p class="empty-state">üîç No social media links found</p>';
			return;
		  }
		  this.createTable();
	  },

    createTable() {
      const tableHtml = `
        <table id="socialTable" class="dataTable-table">
          <thead><tr>
            <th style="width:50px;"><input type="checkbox" class="table-checkbox" onchange="socialManager.toggleSelectAll(this.checked)"></th>
            <th>#</th><th>Platform</th><th>Link</th><th>Status</th><th>Actions</th>
          </tr></thead>
          <tbody>${this.links.map((l, i) => this.createRow(l, i)).join('')}</tbody>
        </table>`;
      document.getElementById('socialTableContainer').innerHTML = tableHtml;
      if (window.simpleDatatables) this.table = new simpleDatatables.DataTable('#socialTable', { searchable: true, perPage: 25, labels: { placeholder: "Search links..." } });
    },

    createRow(link, index) {
      const shortUrl = link.url.length > 45 ? link.url.substring(0, 42) + '...' : link.url;
      return `<tr id="social-row-${index}">
        <td><input type="checkbox" class="table-checkbox social-checkbox" data-index="${index}" onchange="socialManager.toggleSelect(${index}, this.checked)"></td>
        <td><strong>${index + 1}</strong></td>
        <td><span style="display:flex;align-items:center;gap:8px;"><i class="${link.icon}" style="color:${link.color};font-size:18px;"></i><span class="tech-tag" style="background:${link.color};">${link.name}</span></span></td>
        <td><a href="${link.url}" target="_blank" class="table-link" title="${link.url}">${shortUrl}</a></td>
        <td id="social-status-${index}"><span class="status-badge status-unknown">‚è≥ Pending</span></td>
        <td><div class="table-actions">
          <button class="action-btn tooltip" onclick="window.open('${link.url}','_blank')"><i class="fas fa-external-link-alt"></i><span class="tooltiptext">Open</span></button>
          <button class="action-btn tooltip" onclick="copyToClipboard('${link.url}')"><i class="fas fa-copy"></i><span class="tooltiptext">Copy</span></button>
          <button class="action-btn tooltip" onclick="window.open('https://web.archive.org/web/*/${link.url}','_blank')"><i class="fas fa-archive"></i><span class="tooltiptext">Archive</span></button>
          <button class="action-btn tooltip" onclick="socialManager.verifyLink(${index})"><i class="fas fa-check-circle"></i><span class="tooltiptext">Verify</span></button>
        </div></td>
      </tr>`;
    },

    toggleSelect(index, checked) { checked ? this.selected.add(index) : this.selected.delete(index); this.updateSelectedCount(); },
    toggleSelectAll(checked) { document.querySelectorAll('.social-checkbox').forEach((cb, i) => { cb.checked = checked; this.toggleSelect(i, checked); }); },
    selectAll() { this.toggleSelectAll(true); },
    deselectAll() { this.toggleSelectAll(false); },
    updateSelectedCount() { document.getElementById('socialSelectedCount').textContent = `${this.selected.size} selected`; },

    async verifyLink(index) {
      const el = document.getElementById(`social-status-${index}`);
      el.innerHTML = '<span class="status-badge status-checking"><span class="loading-spinner"></span></span>';
      try { await fetch(this.links[index].url, { mode: 'no-cors', cache: 'no-cache' }); el.innerHTML = '<span class="status-badge status-active">‚úÖ Active</span>'; }
      catch { el.innerHTML = '<span class="status-badge status-inactive">‚ùå Failed</span>'; }
    },

    verifySelected() { if (this.selected.size === 0) { showToast('Please select at least one link', 'warning'); return; } let i = 0; this.selected.forEach(idx => { setTimeout(() => this.verifyLink(idx), i * 400); i++; }); },
    archiveSelected() { if (this.selected.size === 0) { showToast('Please select at least one link', 'warning'); return; } this.selected.forEach(i => window.open(`https://web.archive.org/web/*/${this.links[i].url}`, '_blank')); },
    filterByPlatform(p) { if (!p) this.table?.search(''); else this.table?.search(p); },

    exportSelected() {
      if (this.selected.size === 0) { showToast('Please select at least one link', 'warning'); return; }
      const data = []; this.selected.forEach(i => data.push({ platform: this.links[i].name, url: this.links[i].url }));
      const csv = 'Platform,URL\n' + data.map(d => `${d.platform},"${d.url}"`).join('\n');
      downloadFile(csv, `social_links_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
      showToast(`Exported ${this.selected.size} links`, 'success');
    }
  };

  const vulnsManager = {
    table: null, vulns: [{% for v in vulns %}'{{ v }}',{% endfor %}], selected: new Set(),

    init() {
      if (this.vulns.length === 0) { document.getElementById('vulnsTableContainer').innerHTML = '<p class="empty-state" style="color:var(--success-color);">‚úÖ No vulnerabilities detected - Great!</p>'; return; }
      this.createTable();
    },

    parseCVE(str) { const m = str.match(/CVE-\d{4}-\d+/i); return m ? m[0].toUpperCase() : null; },
    severity(str) {
      const l = str.toLowerCase();
      if (l.includes('critical') || l.includes('rce') || l.includes('remote code')) return 'critical';
      if (l.includes('high') || l.includes('sql injection') || l.includes('xss')) return 'high';
      if (l.includes('medium') || l.includes('csrf') || l.includes('disclosure')) return 'medium';
      if (l.includes('low') || l.includes('information')) return 'low';
      return 'unknown';
    },

    createTable() {
      const tableHtml = `
        <table id="vulnsTable" class="dataTable-table">
          <thead><tr>
            <th style="width:50px;"><input type="checkbox" class="table-checkbox" onchange="vulnsManager.toggleSelectAll(this.checked)"></th>
            <th>#</th><th>CVE ID</th><th>Description</th><th>Severity</th><th>Actions</th>
          </tr></thead>
          <tbody>${this.vulns.map((v, i) => this.createRow(v, i)).join('')}</tbody>
        </table>`;
      document.getElementById('vulnsTableContainer').innerHTML = tableHtml;
      if (window.simpleDatatables) this.table = new simpleDatatables.DataTable('#vulnsTable', { searchable: true, perPage: 25, labels: { placeholder: "Search vulnerabilities..." } });
    },

    createRow(vuln, index) {
      const cve = this.parseCVE(vuln);
      const sev = this.severity(vuln);
      const shortDesc = vuln.length > 55 ? vuln.substring(0, 52) + '...' : vuln;
      const sevBadges = { critical: 'risk-critical', high: 'risk-high', medium: 'risk-medium', low: 'risk-low', unknown: 'status-unknown' };
      const sevLabels = { critical: 'üî¥ CRITICAL', high: 'üü† HIGH', medium: 'üü° MEDIUM', low: 'üü¢ LOW', unknown: '‚ö™ UNKNOWN' };
      const bgStyle = sev === 'critical' ? 'background:rgba(239,68,68,0.15);' : '';
      return `<tr id="vuln-row-${index}" style="${bgStyle}">
        <td><input type="checkbox" class="table-checkbox vuln-checkbox" data-index="${index}" onchange="vulnsManager.toggleSelect(${index}, this.checked)"></td>
        <td><strong>${index + 1}</strong></td>
        <td>${cve ? `<code class="code-cell" style="color:#ef4444;font-weight:700;">${cve}</code>` : '<span style="color:var(--text-secondary);">N/A</span>'}</td>
        <td title="${vuln}">${shortDesc}</td>
        <td><span class="status-badge ${sevBadges[sev]}">${sevLabels[sev]}</span></td>
        <td><div class="table-actions">
          <button class="action-btn tooltip" onclick="copyToClipboard(\`${vuln.replace(/`/g, '\\`')}\`)"><i class="fas fa-copy"></i><span class="tooltiptext">Copy</span></button>
          ${cve ? `<button class="action-btn tooltip" onclick="window.open('https://nvd.nist.gov/vuln/detail/${cve}','_blank')"><i class="fas fa-search"></i><span class="tooltiptext">NVD</span></button>
          <button class="action-btn tooltip" onclick="window.open('https://www.exploit-db.com/search?cve=${cve}','_blank')"><i class="fas fa-skull"></i><span class="tooltiptext">Exploits</span></button>
          <button class="action-btn tooltip" onclick="window.open('https://cve.mitre.org/cgi-bin/cvename.cgi?name=${cve}','_blank')"><i class="fas fa-university"></i><span class="tooltiptext">MITRE</span></button>` : ''}
        </div></td>
      </tr>`;
    },

    toggleSelect(index, checked) { checked ? this.selected.add(index) : this.selected.delete(index); this.updateSelectedCount(); },
    toggleSelectAll(checked) { document.querySelectorAll('.vuln-checkbox').forEach((cb, i) => { cb.checked = checked; this.toggleSelect(i, checked); }); },
    selectAll() { this.toggleSelectAll(true); },
    deselectAll() { this.toggleSelectAll(false); },
    updateSelectedCount() { document.getElementById('vulnsSelectedCount').textContent = `${this.selected.size} selected`; },
    filterBySeverity(s) { if (!s) this.table?.search(''); else this.table?.search(s); },

    exportSelected() {
      if (this.selected.size === 0) { showToast('Please select at least one vulnerability', 'warning'); return; }
      const data = []; this.selected.forEach(i => { const v = this.vulns[i]; data.push({ cve: this.parseCVE(v) || 'N/A', desc: v, severity: this.severity(v) }); });
      const csv = 'CVE,Severity,Description\n' + data.map(d => `${d.cve},${d.severity},"${d.desc.replace(/"/g, '""')}"`).join('\n');
      downloadFile(csv, `vulnerabilities_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
      showToast(`Exported ${this.selected.size} vulnerabilities`, 'success');
    },

    generateRemediation() {
      if (this.selected.size === 0) { showToast('Please select at least one vulnerability', 'warning'); return; }
      let md = `# Vulnerability Remediation Guide\n\n**Domain:** {{ sh_domain }}\n**Generated:** ${new Date().toISOString()}\n**Total Issues:** ${this.selected.size}\n\n---\n\n`;
      this.selected.forEach(i => {
        const v = this.vulns[i]; const cve = this.parseCVE(v); const sev = this.severity(v);
        md += `## ${cve || 'Issue #' + (i + 1)}\n\n**Severity:** ${sev.toUpperCase()}\n\n**Description:** ${v}\n\n**Remediation Steps:**\n1. Investigate the vulnerability scope\n2. Apply vendor patches if available\n3. Implement compensating controls\n4. Verify fix effectiveness\n5. Update security documentation\n\n`;
        if (cve) md += `**References:**\n- [NVD](https://nvd.nist.gov/vuln/detail/${cve})\n- [MITRE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=${cve})\n\n`;
        md += '---\n\n';
      });
      downloadFile(md, `remediation_guide_${new Date().toISOString().split('T')[0]}.md`, 'text/markdown');
      showToast('Remediation guide generated', 'success');
    }
  };

  const techManager = {
    table: null, technologies: [], selected: new Set(),

    init() {
      const cats = [
        { n: 'Web Servers', c: 'webserver', i: 'üñ•Ô∏è', clr: '#3b82f6', items: [{% for ws in web_servers %}'{{ ws }}',{% endfor %}] },
        { n: 'CMS', c: 'cms', i: 'üìù', clr: '#f59e0b', items: [{% for cm in cms %}'{{ cm }}',{% endfor %}] },
        { n: 'Languages', c: 'language', i: 'üíª', clr: '#10b981', items: [{% for pl in programming_languages %}'{{ pl }}',{% endfor %}] },
        { n: 'Frameworks', c: 'framework', i: 'üèóÔ∏è', clr: '#8b5cf6', items: [{% for wf in web_frameworks %}'{{ wf }}',{% endfor %}] },
        { n: 'Analytics', c: 'analytics', i: 'üìä', clr: '#06b6d4', items: [{% for a in analytics %}'{{ a }}',{% endfor %}] },
        { n: 'JavaScript', c: 'javascript', i: '‚ö°', clr: '#eab308', items: [{% for js in javascript_frameworks %}'{{ js }}',{% endfor %}] }
      ];
      cats.forEach(cat => cat.items.forEach(item => { if (item) this.technologies.push({ name: item, category: cat.c, catName: cat.n, icon: cat.i, color: cat.clr }); }));
      if (this.technologies.length === 0) { document.getElementById('techTableContainer').innerHTML = '<p class="empty-state">üîç No technologies detected</p>'; return; }
      this.createTable();
    },

    createTable() {
      const tableHtml = `
        <table id="techTable" class="dataTable-table">
          <thead><tr>
            <th style="width:50px;"><input type="checkbox" class="table-checkbox" onchange="techManager.toggleSelectAll(this.checked)"></th>
            <th>#</th><th>Technology</th><th>Category</th><th>Version</th><th>CVE Check</th><th>Actions</th>
          </tr></thead>
          <tbody>${this.technologies.map((t, i) => this.createRow(t, i)).join('')}</tbody>
        </table>`;
      document.getElementById('techTableContainer').innerHTML = tableHtml;
      if (window.simpleDatatables) this.table = new simpleDatatables.DataTable('#techTable', { searchable: true, perPage: 25, labels: { placeholder: "Search technologies..." } });
    },

    parseVersion(str) { const m = str.match(/[\d]+\.[\d]+(?:\.[\d]+)?/); return m ? m[0] : null; },

    createRow(tech, index) {
      const ver = this.parseVersion(tech.name);
      return `<tr id="tech-row-${index}">
        <td><input type="checkbox" class="table-checkbox tech-checkbox" data-index="${index}" onchange="techManager.toggleSelect(${index}, this.checked)"></td>
        <td><strong>${index + 1}</strong></td>
        <td><span style="display:flex;align-items:center;gap:8px;">${tech.icon} <strong>${tech.name}</strong></span></td>
        <td><span class="tech-tag" style="background:${tech.color};">${tech.catName}</span></td>
        <td>${ver ? `<code class="code-cell">${ver}</code>` : '<span style="color:var(--text-secondary);">N/A</span>'}</td>
        <td id="tech-cve-${index}"><span class="status-badge status-unknown">‚è≥ Unchecked</span></td>
        <td><div class="table-actions">
          <button class="action-btn tooltip" onclick="copyToClipboard('${tech.name}')"><i class="fas fa-copy"></i><span class="tooltiptext">Copy</span></button>
          <button class="action-btn tooltip" onclick="techManager.searchCVE('${tech.name}', ${index})"><i class="fas fa-bug"></i><span class="tooltiptext">CVEs</span></button>
          <button class="action-btn tooltip" onclick="window.open('https://www.google.com/search?q=${encodeURIComponent(tech.name + ' documentation')}','_blank')"><i class="fas fa-book"></i><span class="tooltiptext">Docs</span></button>
        </div></td>
      </tr>`;
    },

    toggleSelect(index, checked) { checked ? this.selected.add(index) : this.selected.delete(index); this.updateSelectedCount(); },
    toggleSelectAll(checked) { document.querySelectorAll('.tech-checkbox').forEach((cb, i) => { cb.checked = checked; this.toggleSelect(i, checked); }); },
    selectAll() { this.toggleSelectAll(true); },
    deselectAll() { this.toggleSelectAll(false); },
    updateSelectedCount() { document.getElementById('techSelectedCount').textContent = `${this.selected.size} selected`; },

    searchCVE(name, index) {
      const el = document.getElementById(`tech-cve-${index}`);
      el.innerHTML = '<span class="status-badge status-checking"><span class="loading-spinner"></span></span>';
      window.open(`https://nvd.nist.gov/vuln/search/results?form_type=Basic&results_type=overview&query=${encodeURIComponent(name)}`, '_blank');
      setTimeout(() => { el.innerHTML = '<span class="status-badge" style="background:linear-gradient(135deg,#3b82f6,#60a5fa);">üîó Opened</span>'; }, 600);
    },

    checkCVEs() { if (this.selected.size === 0) { showToast('Please select at least one technology', 'warning'); return; } this.selected.forEach(i => this.searchCVE(this.technologies[i].name, i)); },
    filterByCategory(c) { if (!c) this.table?.search(''); else this.table?.search(c); },

    exportSelected() {
      if (this.selected.size === 0) { showToast('Please select at least one technology', 'warning'); return; }
      const data = []; this.selected.forEach(i => { const t = this.technologies[i]; data.push({ name: t.name, category: t.catName, version: this.parseVersion(t.name) || 'N/A' }); });
      const csv = 'Technology,Category,Version\n' + data.map(d => `"${d.name}",${d.category},${d.version}`).join('\n');
      downloadFile(csv, `technology_stack_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
      showToast(`Exported ${this.selected.size} technologies`, 'success');
    }
  };

  window.addEventListener('DOMContentLoaded', () => {
    // Theme & Font
    if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark');
    const savedFont = localStorage.getItem('fontChoice') || 'inter';
    document.getElementById('fontSelect').value = savedFont;
    changeFont(savedFont);
    if (localStorage.getItem('tocCollapsed') === 'true') {
      document.querySelector('.toc-container').classList.add('collapsed');
      document.body.style.paddingLeft = '80px';
    }

    // Progress bar
    const progressBar = document.querySelector('.progress-bar');
    window.addEventListener('scroll', () => {
      const scrolled = (document.documentElement.scrollTop / (document.documentElement.scrollHeight - document.documentElement.clientHeight)) * 100;
      progressBar.style.width = scrolled + '%';
    });

    // Print button
    document.getElementById('printBtn').addEventListener('click', () => window.print());

    // Initialize all managers
    subdomainManager.init();
    ipManager.init();
    portsManager.init();
    socialManager.init();
    vulnsManager.init();
    techManager.init();

    if (window.Chart) {
      const statsData = [
        parseInt(document.getElementById('a_tsf')?.textContent) || 0,
        parseInt(document.getElementById('a_tsm')?.textContent) || 0,
        parseInt(document.getElementById('a_temails')?.textContent) || 0,
        parseInt(document.getElementById('a_tips')?.textContent) || 0,
        parseInt(document.getElementById('a_tops')?.textContent) || 0,
        parseInt(document.getElementById('a_tpv')?.textContent) || 0
      ];
      const ctx = document.getElementById('statsChart')?.getContext('2d');
      if (ctx) {
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Subdomains', 'Social Media', 'Emails', 'IP Addresses', 'Open Ports', 'Vulnerabilities'],
            datasets: [{ label: 'Count', data: statsData, backgroundColor: ['#6366f1', '#ec4899', '#10b981', '#3b82f6', '#f59e0b', '#ef4444'], borderRadius: 8, borderSkipped: false }]
          },
          options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.05)' } }, x: { grid: { display: false } } } }
        });
      }

      const socialDiv = document.getElementById('socialCounts');
      if (socialDiv) {
        const counts = [parseInt(socialDiv.dataset.fb)||0, parseInt(socialDiv.dataset.tw)||0, parseInt(socialDiv.dataset.inst)||0, parseInt(socialDiv.dataset.tg)||0, parseInt(socialDiv.dataset.tt)||0, parseInt(socialDiv.dataset.li)||0, parseInt(socialDiv.dataset.vk)||0, parseInt(socialDiv.dataset.yt)||0, parseInt(socialDiv.dataset.ok)||0, parseInt(socialDiv.dataset.wc)||0];
        const labels = ['Facebook', 'Twitter/X', 'Instagram', 'Telegram', 'TikTok', 'LinkedIn', 'VK', 'YouTube', 'OK', 'WeChat'];
        const colors = ['#1877f2', '#1da1f2', '#e1306c', '#0088cc', '#000', '#0077b5', '#4a76a8', '#ff0000', '#ff8000', '#7bb32e'];
        let pieData = [], pieLabels = [], pieColors = [];
        for (let i = 0; i < counts.length; i++) { if (counts[i] > 0) { pieData.push(counts[i]); pieLabels.push(labels[i]); pieColors.push(colors[i]); } }
        const ctxPie = document.getElementById('socialPie')?.getContext('2d');
        if (ctxPie && pieData.length > 0) {
          new Chart(ctxPie, { type: 'doughnut', data: { labels: pieLabels, datasets: [{ data: pieData, backgroundColor: pieColors, borderWidth: 0 }] }, options: { responsive: true, plugins: { legend: { position: 'bottom' } }, cutout: '60%' } });
        }
      }
    }

    if (window.vis && document.getElementById('osintNetwork')) {
      const domain = '{{ sh_domain }}';
      const services = [{n:'Web servers',i:[{% for ws in web_servers %}'{{ ws }}',{% endfor %}]},{n:'CMS',i:[{% for cm in cms %}'{{ cm }}',{% endfor %}]},{n:'Languages',i:[{% for pl in programming_languages %}'{{ pl }}',{% endfor %}]},{n:'Frameworks',i:[{% for wf in web_frameworks %}'{{ wf }}',{% endfor %}]},{n:'Analytics',i:[{% for a in analytics %}'{{ a }}',{% endfor %}]},{n:'JS Frameworks',i:[{% for js in javascript_frameworks %}'{{ js }}',{% endfor %}]}];
      const subdomains = [{% for s in subdomains %}'{{ s }}',{% endfor %}];
      const subdomainIPs = [{% for ip in subdomain_ips %}'{{ ip }}',{% endfor %}];
      const socialGroups = [{n:'Facebook',l:[{% for l in fb_links %}'{{ l }}',{% endfor %}]},{n:'Twitter',l:[{% for l in tw_links %}'{{ l }}',{% endfor %}{% for l in xcom_links %}'{{ l }}',{% endfor %}]},{n:'Instagram',l:[{% for l in inst_links %}'{{ l }}',{% endfor %}]},{n:'Telegram',l:[{% for l in tg_links %}'{{ l }}',{% endfor %}]},{n:'TikTok',l:[{% for l in tt_links %}'{{ l }}',{% endfor %}]},{n:'LinkedIn',l:[{% for l in li_links %}'{{ l }}',{% endfor %}]},{n:'VK',l:[{% for l in vk_links %}'{{ l }}',{% endfor %}]},{n:'YouTube',l:[{% for l in yt_links %}'{{ l }}',{% endfor %}]}];
      const ipAddresses = [{% for ip in ip_addresses %}'{{ ip }}',{% endfor %}];
      const ports = [{% for p in ports %}'{{ p }}',{% endfor %}];
      const vulns = [{% for v in vulns %}'{{ v }}',{% endfor %}];

      let nodes, edges, network, expanded = {}, hiddenNodes = new Set(), selectedNode = null, contextNode = null, searchResults = [], searchIndex = 0, physicsEnabled = true;
      const filterState = { services: true, subdomains: true, social: true, ip: true, ports: true, vulns: true };

      function initGraph() {
        nodes = new vis.DataSet([{ id: 'domain', label: domain, color: '#6366f1', level: 0, size: 50, borderWidth: 4, shape: 'dot', title: 'Main Domain', category: 'domain' }]);
        edges = new vis.DataSet([]);
        const first = [
          { id: 'services', label: 'SERVICES', color: '#64748b', category: 'services' },
          { id: 'subdomains', label: `SUBDOMAINS (${subdomains.length})`, color: '#3b82f6', category: 'subdomains' },
          { id: 'social', label: 'SOCIALS', color: '#ec4899', category: 'social' },
          { id: 'ip', label: `IPs (${ipAddresses.length})`, color: '#14b8a6', category: 'ip' },
          { id: 'ports', label: `PORTS (${ports.length})`, color: '#f59e0b', category: 'ports' },
          { id: 'vulns', label: `VULNS (${vulns.length})`, color: '#ef4444', category: 'vulns' }
        ];
        first.forEach(n => { nodes.add({ ...n, level: 1, size: 35, borderWidth: 3, shape: 'dot', title: n.label }); edges.add({ from: 'domain', to: n.id }); });
        updateStats();
      }

      function updateStats() {
        document.getElementById('stat-nodes').textContent = nodes.get().filter(n => !hiddenNodes.has(n.id)).length;
        document.getElementById('stat-edges').textContent = edges.length;
        document.getElementById('stat-depth').textContent = Math.max(...nodes.get().map(n => n.level || 0), 0);
        document.getElementById('stat-selected').textContent = network ? network.getSelectedNodes().length : 0;
        document.getElementById('stat-expanded').textContent = Object.values(expanded).filter(Boolean).length;
      }

      function expandNode(id) {
        if (expanded[id]) return;
        expanded[id] = true;

        if (id === 'services') services.forEach((s, i) => { if (s.i.length) { const sid = 'srv_' + i; if (!nodes.get(sid)) { nodes.add({ id: sid, label: `${s.n} (${s.i.length})`, color: '#94a3b8', level: 2, parent: id, size: 25, shape: 'dot', title: s.n, category: 'services' }); edges.add({ from: 'services', to: sid }); } } });
        if (id.startsWith('srv_')) { const idx = parseInt(id.split('_')[1]); services[idx].i.forEach((item, j) => { const iid = id + '_' + j; if (!nodes.get(iid)) { nodes.add({ id: iid, label: item.length > 20 ? item.substring(0, 17) + '...' : item, color: '#cbd5e1', level: 3, parent: id, size: 16, shape: 'box', title: item, fullData: item, category: 'services' }); edges.add({ from: id, to: iid }); } }); }
        if (id === 'subdomains') subdomains.forEach((s, i) => { const sid = 'sub_' + i; if (!nodes.get(sid)) { nodes.add({ id: sid, label: s.length > 25 ? s.substring(0, 22) + '...' : s, color: '#60a5fa', level: 2, parent: id, size: 22, shape: 'ellipse', title: s, fullData: s, category: 'subdomains' }); edges.add({ from: 'subdomains', to: sid }); if (subdomainIPs[i]) { const ipid = 'sip_' + i; nodes.add({ id: ipid, label: subdomainIPs[i], color: '#5eead4', level: 3, parent: sid, size: 14, shape: 'dot', title: subdomainIPs[i], fullData: subdomainIPs[i], category: 'ip' }); edges.add({ from: sid, to: ipid }); } } });
        if (id === 'social') socialGroups.forEach((g, i) => { if (g.l.length) { const gid = 'soc_' + i; if (!nodes.get(gid)) { nodes.add({ id: gid, label: `${g.n} (${g.l.length})`, color: '#f472b6', level: 2, parent: id, size: 24, shape: 'dot', title: g.n, category: 'social' }); edges.add({ from: 'social', to: gid }); } } });
        if (id.startsWith('soc_')) { const idx = parseInt(id.split('_')[1]); socialGroups[idx].l.forEach((l, j) => { const lid = id + '_' + j; if (!nodes.get(lid)) { nodes.add({ id: lid, label: 'üîó', color: '#fbcfe8', level: 3, parent: id, size: 18, shape: 'dot', title: l, fullData: l, category: 'social' }); edges.add({ from: id, to: lid }); } }); }
        if (id === 'ip') ipAddresses.forEach((ip, i) => { const iid = 'ip_' + i; if (!nodes.get(iid)) { nodes.add({ id: iid, label: ip, color: '#5eead4', level: 2, parent: id, size: 22, shape: 'dot', title: ip, fullData: ip, category: 'ip' }); edges.add({ from: 'ip', to: iid }); } });
        if (id === 'ports') ports.forEach((p, i) => { const pid = 'port_' + i; if (!nodes.get(pid)) { nodes.add({ id: pid, label: p, color: '#fcd34d', level: 2, parent: id, size: 22, shape: 'box', title: p, fullData: p, category: 'ports' }); edges.add({ from: 'ports', to: pid }); } });
        if (id === 'vulns') vulns.forEach((v, i) => { const vid = 'vuln_' + i; if (!nodes.get(vid)) { nodes.add({ id: vid, label: v.length > 20 ? v.substring(0, 17) + '...' : v, color: '#fca5a5', level: 2, parent: id, size: 22, shape: 'box', title: v, fullData: v, category: 'vulns' }); edges.add({ from: 'vulns', to: vid }); } });

        applyFilters();
        updateStats();
      }

      function collapseNode(id) {
        nodes.get().forEach(n => { if (n.parent === id) { collapseNode(n.id); edges.get().forEach(e => { if (e.from === n.id || e.to === n.id) edges.remove(e.id); }); nodes.remove(n.id); } });
        expanded[id] = false;
        updateStats();
      }

      function resetGraph() { nodes.clear(); edges.clear(); expanded = {}; hiddenNodes.clear(); searchResults = []; initGraph(); network.setData({ nodes, edges }); network.fit(); updateStats(); updateNodeInfoPanel(null); }
      function expandAll() { ['services', 'subdomains', 'social', 'ip', 'ports', 'vulns'].forEach(expandNode); setTimeout(() => { services.forEach((_, i) => expandNode('srv_' + i)); socialGroups.forEach((_, i) => expandNode('soc_' + i)); network.fit(); }, 100); }
      function applyFilters() { nodes.get().forEach(n => { if (n.category && n.category !== 'domain') { const hide = !filterState[n.category]; hiddenNodes[hide ? 'add' : 'delete'](n.id); nodes.update({ id: n.id, hidden: hide }); } }); updateStats(); }

      document.querySelectorAll('#graph-filters input').forEach(cb => cb.addEventListener('change', function() { filterState[this.dataset.filter] = this.checked; applyFilters(); }));

      function updateNodeInfoPanel(node) {
        const panel = document.getElementById('nodeInfoPanel');
        const content = document.getElementById('nodeInfoContent');
        const actions = document.getElementById('nodeActions');
        if (!node) { panel.style.display = 'none'; return; }
        panel.style.display = 'flex';
        const data = node.fullData || node.title || node.label;
        const isLink = data && data.startsWith('http');
        content.innerHTML = `<div class="info-row"><span class="info-label">ID</span><span class="info-value">${node.id}</span></div>
          <div class="info-row"><span class="info-label">Label</span><span class="info-value">${node.label}</span></div>
          <div class="info-row"><span class="info-label">Category</span><span class="info-value">${node.category || 'N/A'}</span></div>
          <div class="info-row"><span class="info-label">Level</span><span class="info-value">${node.level}</span></div>
          ${node.fullData ? `<div class="info-row"><span class="info-label">Data</span><span class="info-value" style="font-size:12px;">${node.fullData}</span></div>` : ''}`;
        actions.style.display = 'block';
        document.getElementById('openNodeLinkBtn').style.display = isLink ? 'block' : 'none';
      }

      const ctxMenu = document.getElementById('graphContextMenu');
      document.addEventListener('click', () => ctxMenu.style.display = 'none');
      ctxMenu.querySelectorAll('.ctx-item').forEach(item => item.addEventListener('click', function() {
        const action = this.dataset.action;
        const node = nodes.get(contextNode);
        if (!node) return;
        switch(action) {
          case 'copy': navigator.clipboard.writeText(node.label); break;
          case 'copyAll': navigator.clipboard.writeText(JSON.stringify(node, null, 2)); break;
          case 'open': const l = node.fullData || node.title; if (l && l.startsWith('http')) window.open(l, '_blank'); break;
          case 'expand': expandNode(contextNode); break;
          case 'collapse': collapseNode(contextNode); break;
          case 'highlight': const connected = network.getConnectedNodes(contextNode); connected.push(contextNode); network.selectNodes(connected); break;
          case 'focus': network.focus(contextNode, { scale: 1.5, animation: true }); break;
          case 'hide': hiddenNodes.add(contextNode); nodes.update({ id: contextNode, hidden: true }); updateStats(); break;
        }
        ctxMenu.style.display = 'none';
      }));

      const searchInput = document.getElementById('graphSearchInput');
      const autocomplete = document.getElementById('searchAutocomplete');
      const searchCounter = document.getElementById('searchCounter');

      searchInput.addEventListener('input', function() {
        const val = this.value.toLowerCase();
        if (val.length < 2) { autocomplete.style.display = 'none'; return; }
        const matches = nodes.get().filter(n => (n.label && n.label.toLowerCase().includes(val)) || (n.fullData && n.fullData.toLowerCase().includes(val))).slice(0, 8);
        if (!matches.length) { autocomplete.style.display = 'none'; return; }
        autocomplete.innerHTML = matches.map(m => `<div class="autocomplete-item" data-id="${m.id}"><span class="node-type" style="background:${m.color}">${m.category}</span>${m.label}</div>`).join('');
        autocomplete.style.display = 'block';
        autocomplete.querySelectorAll('.autocomplete-item').forEach(item => item.addEventListener('click', function() {
          const id = this.dataset.id;
          network.selectNodes([id]);
          network.focus(id, { scale: 1.2, animation: true });
          updateNodeInfoPanel(nodes.get(id));
          autocomplete.style.display = 'none';
          searchInput.value = nodes.get(id).label;
        }));
      });

      function performSearch() {
        const val = searchInput.value.toLowerCase();
        if (!val) return;
        searchResults = nodes.get().filter(n => !hiddenNodes.has(n.id) && ((n.label && n.label.toLowerCase().includes(val)) || (n.fullData && n.fullData.toLowerCase().includes(val))));
        searchIndex = 0;
        navigateSearch(0);
        autocomplete.style.display = 'none';
      }

      function navigateSearch(delta) {
        if (!searchResults.length) { searchCounter.textContent = '0/0'; return; }
        searchIndex = (searchIndex + delta + searchResults.length) % searchResults.length;
        const node = searchResults[searchIndex];
        network.selectNodes([node.id]);
        network.focus(node.id, { scale: 1.2, animation: true });
        updateNodeInfoPanel(node);
        searchCounter.textContent = `${searchIndex + 1}/${searchResults.length}`;
      }

      document.getElementById('graphSearchBtn').onclick = performSearch;
      document.getElementById('graphPrevBtn').onclick = () => navigateSearch(-1);
      document.getElementById('graphNextBtn').onclick = () => navigateSearch(1);
      document.getElementById('graphClearBtn').onclick = () => { searchInput.value = ''; searchResults = []; searchCounter.textContent = '0/0'; network.unselectAll(); autocomplete.style.display = 'none'; };
      searchInput.addEventListener('keydown', e => { if (e.key === 'Enter') performSearch(); });
      document.getElementById('exportPngBtn').onclick = () => { const canvas = document.querySelector('#osintNetwork canvas'); if (canvas) { const a = document.createElement('a'); a.href = canvas.toDataURL('image/png'); a.download = `osint_graph_${domain}.png`; a.click(); } };
      document.getElementById('exportJsonBtn').onclick = () => { const data = { domain, nodes: nodes.get(), edges: edges.get(), exportDate: new Date().toISOString() }; downloadFile(JSON.stringify(data, null, 2), `osint_graph_${domain}.json`, 'application/json'); };
      document.getElementById('exportSvgBtn').onclick = () => { const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="600"><rect fill="#f8fafc" width="100%" height="100%"/><text x="50%" y="50%" text-anchor="middle" font-size="24" font-family="Inter">OSINT Graph: ${domain} (${nodes.length} nodes)</text></svg>`; downloadFile(svg, `osint_graph_${domain}.svg`, 'image/svg+xml'); };
      document.getElementById('resetGraphBtn').onclick = resetGraph;
      document.getElementById('expandAllBtn').onclick = expandAll;
      document.getElementById('collapseBtn').onclick = function() { if (selectedNode) { collapseNode(selectedNode); this.disabled = true; } };
      document.getElementById('fitGraphBtn').onclick = () => network.fit({ animation: true });
      document.getElementById('physicsToggleBtn').onclick = function() { physicsEnabled = !physicsEnabled; network.setOptions({ physics: { enabled: physicsEnabled } }); this.innerHTML = `<i class="fas fa-atom"></i> Physics: ${physicsEnabled ? 'ON' : 'OFF'}`; };
      document.getElementById('clusterBtn').onclick = () => network.cluster({ joinCondition: n => n.group === 'subdomain', clusterNodeProperties: { id: 'cluster:sub', label: `üì¶ Subdomains (${subdomains.length})`, color: '#3b82f6', shape: 'database', size: 45 } });
      document.getElementById('unclusterBtn').onclick = () => { try { network.openCluster('cluster:sub'); } catch {} };
      document.getElementById('copyNodeBtn').onclick = () => { if (selectedNode) copyToClipboard(nodes.get(selectedNode).fullData || nodes.get(selectedNode).label); };
      document.getElementById('openNodeLinkBtn').onclick = () => { if (selectedNode) { const n = nodes.get(selectedNode); const l = n.fullData || n.title; if (l && l.startsWith('http')) window.open(l, '_blank'); } };
      document.getElementById('highlightConnectedBtn').onclick = () => { if (selectedNode) { const connected = network.getConnectedNodes(selectedNode); connected.push(selectedNode); network.selectNodes(connected); } };

      const graphDiv = document.getElementById('osintNetwork');
      const exitBtn = document.getElementById('exitFullscreenBtn');
      document.getElementById('fullscreenGraphBtn').onclick = () => { graphDiv.classList.add('fullscreen'); document.body.classList.add('fullscreen-graph'); exitBtn.style.display = 'block'; setTimeout(() => network.fit(), 200); };
      exitBtn.onclick = () => { graphDiv.classList.remove('fullscreen'); document.body.classList.remove('fullscreen-graph'); exitBtn.style.display = 'none'; setTimeout(() => network.fit(), 200); };
      document.addEventListener('keydown', e => { if (e.key === 'Escape' && graphDiv.classList.contains('fullscreen')) exitBtn.click(); });

      initGraph();

      network = new vis.Network(document.getElementById('osintNetwork'), { nodes, edges }, {
        layout: { hierarchical: false },
        nodes: { font: { size: 14, face: 'Inter, sans-serif', color: '#1e293b' } },
        edges: { smooth: { type: 'cubicBezier' }, width: 2, color: { color: '#94a3b8', highlight: '#6366f1' } },
        physics: { stabilization: { iterations: 100 }, barnesHut: { gravitationalConstant: -3000 } },
        interaction: { hover: true, navigationButtons: true, keyboard: true, multiselect: true, tooltipDelay: 200 }
      });

      network.on('click', params => {
        if (params.nodes.length === 1) {
          selectedNode = params.nodes[0];
          document.getElementById('collapseBtn').disabled = false;
          expandNode(selectedNode);
          updateNodeInfoPanel(nodes.get(selectedNode));
          network.focus(selectedNode, { animation: true });
        } else {
          selectedNode = null;
          document.getElementById('collapseBtn').disabled = true;
          updateNodeInfoPanel(null);
        }
        updateStats();
      });

      network.on('doubleClick', params => { if (params.nodes.length === 1) collapseNode(params.nodes[0]); });
      network.on('oncontext', params => { params.event.preventDefault(); if (params.nodes.length === 1) { contextNode = params.nodes[0]; ctxMenu.style.left = params.event.pageX + 'px'; ctxMenu.style.top = params.event.pageY + 'px'; ctxMenu.style.display = 'block'; } });

      document.getElementById('nodeInfoPanel').style.display = 'flex';
      updateStats();
    }
  });
</script>
</body>
</html>
